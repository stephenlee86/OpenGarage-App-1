{"version":3,"sources":["app.min.js"],"names":["angular","module","run","$state","$ionicPlatform","$ionicScrollDelegate","$document","$window","$rootScope","$filter","$ionicLoading","$timeout","Utils","Cloud","Watch","ready","open","url","window","SafariViewController","isAvailable","available","show","tintColor","barColor","controlTintColor","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleLightContent","backgroundColorByHexString","element","on","scrollTop","geofence","hasGeofence","startGeofence","callback","initialize","then","getWatched","fences","geoFences","JSON","parse","handleGeofence","geofences","notification","$apply","forEach","geo","data","id","split","controller","controllers","mac","door","toggleDoor","apikey","onTransitionReceived","onNotificationClicked","ThreeDeeTouch","updateQuickLinks","enableLinkPreview","onHomeIconPressed","payload","type","applewatch","navigator","simulator","init","noop","toggleDoorByIndex","index","auth","onLoadAppMainRequest","loadApp","splashscreen","hide","err","connected","version","appVersion","loadingQueue","$on","e","scope","$new","canceller","resolve","$broadcast","push","template","pop","length","title","checkNewController","sync","firstLoadHandler","event","preventDefault","storage","get","activeController","go","updateController","cloudToken","content","document","getElementById","innerWidth","width","config","$stateProvider","$urlRouterProvider","$httpProvider","$compileProvider","$ionicConfigProvider","test","userAgent","platform","default","spinner","icon","backButton","previousTitleText","text","scrolling","jsScrolling","aHrefSanitizationWhitelist","imgSrcSanitizationWhitelist","state","templateUrl","abstract","views","menuContent","checkValid","$q","total","filterFilter","invalidOrg","remove","reject","setController","interceptors","$injector","request","match","cancel","defer","timeout","promise","retryCount","suppressLoader","response","responseError","error","$$state","status","canceled","$http","retryFailed","forwardCache","filter","items","filterOn","isUndefined","isArray","newItems","extractValueToCompare","item","isObject","isString","isDuplicate","i","equals","directive","restrict","replace","rule","link","map","marker","circle","updateRule","addOrUpdate","direction","latitude","start","lat","longitude","lng","radius","transitionType","openAppOnClick","updateMarker","setMap","google","maps","Marker","position","updateRadius","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","center","parseInt","updateMap","enable","setTimeout","Map","querySelectorAll","zoom","streetViewControl","mapTypeControl","addListener","latLng","$watch","currentRule","geolocation","getCurrentPosition","coords","factory","Settings","$httpParamSerializerJQLike","$ionicPopup","requestAuth","buttons","onTap","username","password","isValid","login","syncStart","user","pass","method","httpServer","headers","Content-Type","email","encodeURIComponent","result","undefined","set","cloudDataToken","sjcl","codec","hex","fromBits","hash","sha256","isSynced","logout","getControllers","stringify","Object","keys","deleteController","device","local","deviceid","params","hasOwnProperty","saveController","name","group","ipAddr","success","saveControllers","token","controllerType","sites","encrypt","message","handleExpiredLogin","handleInvalidDataToken","prompt","subTitle","inputType","inputPlaceholder","confirm","getTokenUser","atob","isLoggedIn","$scope","submit","alert","skipCloud","$ionicModal","$ionicHistory","showDelete","selectPhoto","nextViewOptions","historyRoot","ans","getControllerIndex","splice","getTime","timestamp","Date","toLocaleString","changeSync","startTimeout","pendingRequests","getLogs","reply","onLogs","current","day","isLocal","toDateString","isDivider","logs","clearTimeout","settings","changePassword","restart","restartController","saveOptions","getControllerOptions","mod","fwv","$ionicActionSheet","$ionicSideMenuDelegate","sideMenuDraggable","showAddController","titleText","cancelText","buttonClicked","closeMenu","toggleLeft","indexOf","currentIndex","changeController","to","reset","home","away","isAndroid","ionic","Platform","CloudProxy","isFireFox","isIE","query","localStorage","getItem","setItem","removeItem","intToIP","int","getControllerSettings","ip","referer","cmd","q","args","ch","isCloud","send","lastUpdate","showLoader","r","copy","save","extend","mnt","when","cancelPendingHttp","addController","join","defaultIp","ssids","modal","connectNewController","fromTemplateUrl","animation","ssid","saveNewController","scanLocalNetwork","networkinterface","getIPAddress","router","baseip","check","matches","catch","queue","all","requestPassword","links","limit","iconType","configureQuickActions","pendingReq","HTMLElement","prototype","click","evt","this","ownerDocument","createEvent","initMouseEvent","defaultView","dispatchEvent","canScan","scan","foundControllers","popup","close","showAddBlynk","p","dkey","reboot","pwd","nkey","ckey","sort","a","b","$event","deletePhoto","fileInput","image","cropped","uploadPhoto","crop","stopPropagation","parent","one","file","files","reader","FileReader","onload","target","readAsDataURL","post","deferred","paramSerializer","domain","websocketServer","http","loadAppMain","label","value","color","font","size","table","alpha","rows","makeAppList","backgroundColor","cornerRadius","canvas","createElement","ctx","getContext","img","Image","src","height","drawImage","imageLeft","toDataURL"],"mappings":"AAIAA,QAAQC,OAAQ,cAAgB,QAAS,YAAa,yBAA0B,mBAAoB,mBAAoB,qBACtHC,IAAK,SAAUC,OAAQC,eAAgBC,qBAAsBC,UAAWC,QAASC,WAAYC,QAASC,cAAeC,SAAUC,MAAOC,MAAOC,OAG7IV,eAAeW,MAAO,WAyCrB,GAtCAP,WAAWQ,KAAO,SAAUC,KACtBC,OAAOC,qBACXD,OAAOC,qBAAqBC,YAAa,SAAUC,WAC7CA,UACJH,OAAOC,qBAAqBG,MAC3BL,IAAKA,IACLM,UAAW,UACXC,SAAU,UACVC,iBAAkB,YAGnBP,OAAOF,KAAMC,IAAK,SAAU,yBAI9BC,OAAOF,KAAMC,IAAK,SAAU,wBAMzBC,OAAOQ,SAAWR,OAAOQ,QAAQC,SAAWT,OAAOQ,QAAQC,QAAQC,UAAYV,OAAOQ,QAAQC,QAAQC,SAASC,0BACnHX,OAAOQ,QAAQC,QAAQC,SAASC,0BAA0B,GAEtDX,OAAOY,YAGLZ,OAAOY,UAAUC,oBAGXb,OAAOY,UAAUE,2BAA4B,QAGzDhC,QAAQiC,QAAS1B,SAAU2B,GAAI,YAAa,WAC3C7B,qBAAqB8B,eAIlBjB,OAAOkB,SAAW,CACtB5B,WAAW6B,aAAc,EAEzB7B,WAAW8B,cAAgB,SAAUC,UACpCrB,OAAOkB,SAASI,aAAaC,KAAM,WAClCF,UAAU,IACR,WACFA,UAAU,MAIZrB,OAAOkB,SAASM,WAAY,SAAUC,QACrCnC,WAAWoC,UAAYC,KAAKC,MAAOH,SAGpC,IAAII,gBAAiB,SAAUC,WACzBA,YAGCA,UAAUC,eACdD,WAAcA,YAGfxC,WAAW0C,OAAQ,WAClBF,UAAUG,QAAS,SAAUC,KAC5B,GAAIC,MAAOD,IAAIH,aAAaK,GAAGC,MAAO,KACrCC,WAAa/C,QAAS,UAAYD,WAAWiD,aAAeC,IAAOL,KAAM,IAErEG,aACY,SAAdH,KAAM,IAAsC,IAApBG,WAAWG,MACrB,UAAdN,KAAM,IAAuC,IAApBG,WAAWG,MACrC/C,MAAMgD,WAAYJ,WAAWK,aAOnC3C,QAAOkB,SAAS0B,qBAAuBf,eACvC7B,OAAOkB,SAAS2B,sBAAwBhB,eAGpC7B,OAAO8C,gBACXpD,MAAMqD,mBAEN/C,OAAO8C,cAAcE,oBAErBhD,OAAO8C,cAAcG,kBAAoB,SAAUC,SAElD,GAAIf,MAAOe,QAAQC,KAAKd,MAAO,IAE/B,IAAmB,WAAdF,KAAM,GAAmB,CAC7B,GAAIG,YAAa/C,QAAS,UAAYD,WAAWiD,aAAeC,IAAOL,KAAM,IACxEG,aACJ5C,MAAMgD,WAAYJ,WAAWK,WAM5B3C,OAAOoD,YAAcpD,OAAOqD,UAAUC,aAAc,IACxDtD,OAAOoD,WAAWG,KAAMzE,QAAQ0E,MAEhCxD,OAAOyD,kBAAoB,SAAUC,OACpChE,MAAMgD,WAAYpD,WAAWiD,YAAamB,OAAQC,OAGnD3D,OAAOoD,WAAW/B,SAASuC,qBAAuBhE,MAAMiE,SAItDpE,SAAU,WACN,IACI4D,UAAUS,aAAaC,OACzB,MAAQC,QACX,OAIP1E,WAAW2E,WAAY,EAGvB3E,WAAW4E,QAAUlE,OAAOmE,WAGzB7E,WAAW8E,gBAGX9E,WAAWiD,eAGdjD,WAAW+E,IAAK,eAAgB,SAAUC,EAAGnC,MAC5C,GAAIoC,OAAQjF,WAAWkF,MAEvBD,OAAME,UAAYtC,KAAOA,KAAKsC,UAAUC,QAAU,WACjDpF,WAAWqF,WAAY,iBAGxBrF,WAAW8E,aAAaQ,KAAML,MAAME,WACpCjF,cAAcY,MACbyE,SAAU,uKACVN,MAAOA,UAKTjF,WAAW+E,IAAK,eAAgB,WAI/B,GAFA/E,WAAW8E,aAAaU,MACxBtF,cAAcuE,OACTzE,WAAW8E,aAAaW,OAAS,EAAI,CACzC,GAAIR,OAAQjF,WAAWkF,MACvBD,OAAME,UAAYnF,WAAW8E,aAAc9E,WAAW8E,aAAaW,OAAS,GAC5EvF,cAAcY,MACbyE,SAAU,uKACVN,MAAOA,WAMVjF,WAAW+E,IAAK,wBAAyB,WACxCjF,UAAW,GAAI4F,MAAQ,eAGxBlG,QAAQiC,QAAS3B,WAAY4B,GAAI,SAAU,WAC1CvB,SAAU,WACTC,MAAMuF,qBACNtF,MAAMuF,QACJ,MAIJ,IAAIC,kBAAmB7F,WAAW+E,IAAK,oBAAqB,SAAUe,OAGlED,mBAGGC,MAAMC,iBAET3F,MAAM4F,QAAQC,KAAO,mBAAoB,cAAe,cAAgB,SAAUpD,MAEpF,IACC7C,WAAWiD,YAAcZ,KAAKC,MAAOO,KAAKI,aAC1CjD,WAAWkG,iBAAmB7D,KAAKC,MAAOO,KAAKqD,kBAC9C,MAAQxB,MAEJ1E,WAAWiD,cAChBjD,WAAWiD,gBAGZ5C,MAAMuF,OAGK5F,WAAWkG,kBAA2D,gBAAhClG,YAAWkG,kBAG3DvG,OAAOwG,GAAI,YAEX/F,MAAMgG,oBAEDpG,WAAWiD,YAAYwC,QAAU5C,KAAKwD,WAC1C1G,OAAOwG,GAAI,wBAEXxG,OAAOwG,GAAI,WAKX/F,MAAMuF,sBAIVnG,SAAQiC,QAASf,QAASgB,GAAI,SAAU,WACvC1B,WAAWqF,WAAY,gBACvB,IAAIiB,SAAUC,SAASC,eAAgB,cAClCF,UAAW5F,OAAO+F,WAAa,MACnCH,QAAQI,MAAQhG,OAAO+F,WAAa,SAKtCE,OAAQ,SAAUC,eAAgBC,mBAAoBC,cAAeC,iBAAkBC,sBAElF,0BAA0BC,KAAMvG,OAAOqD,UAAUmD,YAGrDF,qBAAqBG,SAASC,QAAQC,QAAQC,KAAM,WAIrDN,qBAAqBO,WAAWC,mBAAmB,GAAQC,KAAM,QAG5D,UAAUR,KAAMlD,UAAUmD,YAC9BF,qBAAqBU,UAAUC,aAAa,GAI7CZ,iBAAiBa,2BAA4B,4DAG7Cb,iBAAiBc,4BAA6B,gGAG9CjB,eACEkB,MAAO,SACPrH,IAAK,SACLsH,YAAa,uBACb/E,WAAY,cAKZ8E,MAAO,OACPrH,IAAK,OACLuH,UAAU,EACVD,YAAa,sBACb/E,WAAY,aAGZ8E,MAAO,YACPrH,IAAK,QACLwH,OACCC,aACCH,YAAa,sBACb/E,WAAY,aAGdoC,SACC+C,WAAY,SAAUhI,SAAUiI,GAAIzI,OAAQK,WAAYC,QAASG,OAChE,GAAIiI,OAAQrI,WAAWiD,YAAYwC,OAClC6C,aAAerI,QAAS,UACxBsI,cAAevI,WAAWkG,kBAAkH,IAA9FoC,aAActI,WAAWiD,aAAeC,IAAOlD,WAAWkG,iBAAiBhD,MAAQuC,OAElI,OAAMzF,YAAWkG,kBAA8B,IAAVmC,OAK/BrI,WAAWkG,kBAAoBqC,kBAE7BvI,YAAWkG,iBAClB9F,MAAM4F,QAAQwC,OAAQ,oBAGtBrI,SAAU,WACTR,OAAOwG,GAAI,0BAGLiC,GAAGK,UAVX,WAJCrI,OAAMsI,cAAe,OAoBxBZ,MAAO,aACPrH,IAAK,SACLwH,OACCC,aACCH,YAAa,uBACb/E,WAAY,gBAKd8E,MAAO,wBACPrH,IAAK,oBACLwH,OACCC,aACCH,YAAa,kCACb/E,WAAY,2BAKd8E,MAAO,eACPrH,IAAK,WACLwH,OACCC,aACCH,YAAa,yBACb/E,WAAY,gBAGdoC,SACC+C,WAAY,SAAUnI,WAAYoI,IACjC,IAAMpI,WAAWkG,iBAChB,MAAOkC,IAAGK,aAMbX,MAAO,gBACPrH,IAAK,YACLwH,OACCC,aACCH,YAAa,0BACb/E,WAAY,iBAGdoC,SACC+C,WAAY,SAAUnI,WAAYoI,IACjC,IAAMpI,WAAWkG,iBAChB,MAAOkC,IAAGK,aAMbX,MAAO,YACPrH,IAAK,QACLwH,OACCC,aACCH,YAAa,0BAMfD,MAAO,aACPrH,IAAK,QACL8E,SAAU,GACVvC,WAAY,SAAUrD,OAAQK,YAExBA,WAAWkG,iBACfvG,OAAOwG,GAAI,YAEXxG,OAAOwG,GAAI,2BAMfW,cAAc6B,aAAarD,KAAM,SAAUtF,WAAYoI,GAAIQ,WAC1D,OACCC,QAAS,SAAUlC,QAqBlB,MAlBKA,QAAOlG,IAAIqI,MAAO,aAGtBnC,OAAOoC,OAASX,GAAGY,QAGnBrC,OAAOsC,QAAUtC,OAAOoC,OAAOG,QAGG,gBAAtBvC,QAAOwC,aAClBxC,OAAOwC,WAAa,GAGfxC,OAAOyC,gBACZpJ,WAAWqF,WAAY,gBAAkBF,UAAWwB,OAAOoC,UAItDpC,QAER0C,SAAU,SAAUA,UAOnB,OAJMA,SAAS1C,OAAOyC,gBAAkBC,SAAS1C,OAAOlG,IAAIqI,MAAO,YAClE9I,WAAWqF,WAAY,gBAGjBgE,UAERC,cAAe,SAAUC,OAYxB,GATKA,MAAM5C,OAAOsC,SAAWM,MAAM5C,OAAOsC,QAAQO,SAAmD,IAAxCD,MAAM5C,OAAOsC,QAAQO,QAAQC,SACzFF,MAAMG,UAAW,IAGZH,MAAM5C,OAAOyC,gBAAkBG,MAAM5C,OAAOlG,IAAIqI,MAAO,YAC5D9I,WAAWqF,WAAY,gBAInBkE,MAAME,QAAU,IAAMF,MAAMG,SAAW,CAC3C,GAAKH,MAAM5C,OAAOwC,WAAa,EAAI,CAClC,GAAIQ,OAAQf,UAAU3C,IAAK,QAK3B,OAHAsD,OAAM5C,OAAOwC,aAGNQ,MAAOJ,MAAM5C,QAOpB,MAHA4C,OAAMK,aAAc,EACpBL,MAAMG,UAAW,EAEVtB,GAAGK,OAAQc,OAIpB,MAAOnB,IAAGK,OAAQc,WAMrBvC,qBAAqBiB,MAAM4B,cAAc,KAGzCC,OAAQ,SAAU,WAClB,MAAO,UAAUC,MAAOC,UACvB,GAAKA,YAAa,EACjB,MAAOD,MAGR,KAAOC,UAAYxK,QAAQyK,YAAaD,YAAgBxK,QAAQ0K,QAASH,OAAU,CAClF,GAAII,aACHC,sBAAwB,SAAUC,MACjC,MAAK7K,SAAQ8K,SAAUD,OAAU7K,QAAQ+K,SAAUP,UAC3CK,KAAML,UAENK,KAIV7K,SAAQmD,QAASoH,MAAO,SAAUM,MAGjC,IAAM,GAFFG,cAAc,EAERC,EAAI,EAAGA,EAAIN,SAAS1E,OAAQgF,IACrC,GAAKjL,QAAQkL,OAAQN,sBAAuBD,SAAUM,IAAOL,sBAAuBC,OAAW,CAC9FG,aAAc,CACd,OAGIA,aACLL,SAAS7E,KAAM+E,QAGjBN,MAAQI,SAEV,MAAOJ,UAIPY,UAAW,eAAgB,SAAU3K,WAAYC,SACjD,OACC2K,SAAU,IACVC,SAAS,EACT5F,OACC6F,KAAM,KAEP/C,YAAa,8BACbgD,KAAM,SAAU9F,MAAOxD,SACtB,GAAIuJ,KAAKC,OAAQC,MAEjBjG,OAAMkG,WAAa,WAClBnL,WAAW8B,cAAe,WACzBpB,OAAOkB,SAASwJ,aACftI,GAAImC,MAAM6F,KAAKO,UAAY,IAAMrL,WAAWkG,iBAAiBhD,IAC7DoI,SAAUrG,MAAM6F,KAAKS,MAAMC,IAC3BC,UAAWxG,MAAM6F,KAAKS,MAAMG,IAC5BC,OAAQ1G,MAAM6F,KAAKa,OACnBC,eAAyC,SAAzB3G,MAAM6F,KAAKO,UAAuB,EAAI,EACtD5I,cACCiD,MAAO,sBACP+B,KAAM,eAAiBxC,MAAM6F,KAAKO,UAAY,sBAC9CQ,gBAAgB,IAEf,WACFnL,OAAOkB,SAASM,WAAY,SAAUC,QACrCnC,WAAWoC,UAAYC,KAAKC,MAAOH,eAMvC8C,MAAM6G,aAAe,WACfb,QACJA,OAAOc,OAAQ,MAGhBd,OAAS,GAAIe,QAAOC,KAAKC,QACxBC,SAAUlH,MAAM6F,KAAKS,MACrBP,IAAKA,MAGN/F,MAAMkG,cAGPlG,MAAMmH,aAAe,WACflB,QACJA,OAAOa,OAAQ,MAGhBb,OAAS,GAAIc,QAAOC,KAAKI,QACxBC,YAAa,UACbC,cAAe,GACfC,aAAc,EACdC,UAAW,UACXC,YAAa,IACb1B,IAAKA,IACL2B,OAAQ1H,MAAM6F,KAAKS,MACnBI,OAAQiB,SAAU3H,MAAM6F,KAAKa,UAG9B1G,MAAMkG,cAGPlG,MAAM4H,UAAY,WACjB,MAAM5H,OAAM6F,KAAKgC,WASjBC,YAAY,WACX/B,IAAM,GAAIgB,QAAOC,KAAKe,IAAKvL,QAAS,GAAIwL,iBAAkB,QAAU,IACnEC,KAAM,GACNC,mBAAmB,EACnBC,gBAAgB,EAChBT,OAAQ1H,MAAM6F,KAAKS,QAGpBS,OAAOC,KAAKnG,MAAMuH,YAAarC,IAAK,QAAS,SAAUhG,GACtDC,MAAM6F,KAAKS,OAAUC,IAAKxG,EAAEsI,OAAO9B,MAAOE,IAAK1G,EAAEsI,OAAO5B,OACxDzG,MAAM6G,eACN7G,MAAMmH,iBAGPnH,MAAM6G,eACN7G,MAAMmH,gBACJ,SAxBF1L,QAAOkB,SAAS4G,OAAQvD,MAAM6F,KAAKO,UAAY,IAAMrL,WAAWkG,iBAAiBhD,IAAK,WACrFxC,OAAOkB,SAASM,WAAY,SAAUC,QACrCnC,WAAWoC,UAAYC,KAAKC,MAAOH,aAyBvC8C,MAAMsI,OAAQ,OAAQ,WACrB,GAAIC,aAAcvN,QAAS,UAAYD,WAAWoC,WAAaU,GAAMmC,MAAM6F,KAAKO,UAAY,IAAMrL,WAAWkG,iBAAiBhD,MAAS,EAElIsK,cACJvI,MAAM6F,KAAKa,OAAS6B,YAAY7B,OAChC1G,MAAM6F,KAAKS,OAAUC,IAAKgC,YAAYlC,SAAUI,IAAK8B,YAAY/B,WACjExG,MAAM6F,KAAKgC,QAAS,EACpB7H,MAAM4H,cAEN5H,MAAM6F,KAAKa,OAAS1G,MAAM6F,KAAKa,QAAU,IACzC1G,MAAM6F,KAAKS,MAAQtG,MAAM6F,KAAKS,QAAWC,IAAK,UAAWE,KAAK,WAC9DzG,MAAM6F,KAAKgC,OAAS7H,MAAM6F,KAAKgC,SAAU,EAEzC9M,WAAW8B,cAAe,WACzBiC,UAAU0J,YAAYC,mBAAoB,SAAUvB,UACnDlH,MAAM6F,KAAKS,OAAUC,IAAKW,SAASwB,OAAOrC,SAAUI,IAAKS,SAASwB,OAAOlC,WACzExG,MAAM4H,aACJ,WACF5H,MAAM4H,cACF5D,QAAS,eAWrBzJ,QAAQC,OAAQ,oBAAsB,qBACjCmO,QAAS,SAAW,YAAa,aAAc,QAAS,WAAY,SAAUhF,UAAW5I,WAAYI,MAAOyN,UAEzG,GA0QIlE,OAAOmE,2BAA4BC,YA1QnCC,YAAc,WACVD,YAAcA,aAAenF,UAAU3C,IAAK,cAE5C,IAAIhB,OAAQjF,WAAWkF,MACvBD,OAAMpC,QAENkL,YAAYjN,MACRiH,YAAa,4BACbrC,MAAO,sBACPT,MAAOA,MACPgJ,UACMxG,KAAM,WAEJA,KAAM,eACN5D,KAAM,kBACNqK,MAAO,SAAUlJ,GACb,SAAMC,MAAMpC,KAAKsL,WAAalJ,MAAMpC,KAAKuL,eACrCpJ,GAAEe,sBAQlB9D,KAAM,SAAUoM,SACXA,SACDC,MAAOrJ,MAAMpC,KAAKsL,SAAUlJ,MAAMpC,KAAKuL,SAAUG,cAI7DD,MAAQ,SAAUE,KAAMC,KAAM1M,UAC1BA,SAAWA,UAAY,aACvB4H,MAAQA,OAASf,UAAU3C,IAAK,SAChC6H,2BAA6BA,4BAA8BlF,UAAU3C,IAAK,8BAC1E0D,OACI+E,OAAQ,OACRjO,IAAKoN,SAASc,WAAa,mBAC3BC,SACIC,eAAgB,oDAEpBhM,KAAMiL,4BACFgB,MAAOC,mBAAoBP,MAC3BJ,SAAUW,mBAAoBN,UAElCxM,KAAM,SAAU+M,QACUC,SAArBD,OAAOnM,KAAK2L,OACbpO,MAAM4F,QAAQkJ,KACV7I,WAAc2I,OAAOnM,KAAK2L,KAAKnL,OAC/B8L,eAAkBC,KAAKC,MAAMC,IAAIC,SAAUH,KAAKI,KAAKC,OAAOD,KAAMf,SAEtEzO,WAAW0P,UAAW,GAE1B3N,SAAUiN,SACX,WACCjN,UAAU,MAGlB4N,OAAS,WACLvP,MAAM4F,QAAQwC,OAAQ,cACtBxI,WAAW0P,UAAW,GAE1BnB,UAAY,WAERqB,eAAgB,SAAU3M,aACjBZ,KAAKwN,UAAW5M,eAAkBZ,KAAKwN,UAAW7P,WAAWiD,cAI7D6M,OAAOC,KAAM9M,aAAcwC,OAAS,IACrCzF,WAAWiD,YAAcA,YACzB7C,MAAM4F,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAW5M,cAAiB,cACrE7C,MAAMqD,uBAIlBmC,KAAO,SAAU7D,UACbA,SAAWA,UAAY,aACvB6N,eAAgB,SAAU/M,MACjBA,QAAS,IACVzC,MAAM4F,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAWhN,OAAUd,UAC9D/B,WAAWiD,YAAcJ,KACzBzC,MAAMqD,uBAIlBuM,iBAAmB,SAAUC,OAAQlO,UACjCA,SAAWA,UAAY,aACvB4H,MAAQA,OAASf,UAAU3C,IAAK,QAChC,IAAIiK,OAAQ9P,MAAM4F,QAAQC,KAAO,cACjC0D,QACI+E,OAAQ,SACRjO,IAAKoN,SAASc,WAAa,eAAiBsB,OAAOE,SACnDvB,SACIC,eAAgB,oDAEpBuB,QACI/M,OAAU6M,MAAM7J,cAEpBpE,KAAM,SAAU+M,QAChBjN,SAAUiN,OAAOnM,OAClB,WACCd,UAAU,MAGlB6N,eAAiB,SAAU7N,UACvBA,SAAWA,UAAY,aACvB4H,MAAQA,OAASf,UAAU3C,IAAK,SAChC6H,2BAA6BA,4BAA8BlF,UAAU3C,IAAK,8BAE1E7F,MAAM4F,QAAQC,KAAO,cAAgB,SAAUiK,OAC3C,MAA0BjB,UAArBiB,MAAM7J,YAAiD,OAArB6J,MAAM7J,eACzCtE,WAAU,OAId4H,QACI+E,OAAQ,MACRjO,IAAKoN,SAASc,WAAa,cAC3BC,SACIC,eAAgB,oDAEpBuB,QACI/M,OAAU6M,MAAM7J,cAEpBpE,KAAM,SAAU+M,QAChB,GAA4BC,SAAvBD,OAAOnM,KAAK4C,OACb,IAAM,GAAIgF,KAAKuE,QAAOnM,KACZmM,OAAOnM,KAAM4H,GAAI4F,eAAgB,SACnCrB,OAAOnM,KAAM4H,GAAIvH,IAAM8L,OAAOnM,KAAM4H,GAAI0F,SAIpDpO,UAAUiN,OAAOnM,OAClB,WACCd,UAAU,QAItBuO,eAAiB,SAAUvO,UACE,kBAAbA,YACRA,SAAW,cAEf4H,MAAQA,OAASf,UAAU3C,IAAK,SAChC6H,2BAA6BA,4BAA8BlF,UAAU3C,IAAK,8BAE1E7F,MAAM4F,QAAQC,KAAO,aAAc,kBAAoB,SAAUiK,OAC7D,GAA0B,OAArBA,MAAM7J,YAA4C4I,SAArBiB,MAAM7J,WAEpC,WADAtE,WAAU,EAGd,IAAIc,OACA0N,KAAM,UACNC,MAAO,UACPL,SAAU,WACV9M,OAAQ6M,MAAM7J,WACdxC,KAAM,KACN4M,OAAQ,OAGZ9G,QACI+E,OAAQ,OACRjO,IAAKoN,SAASc,WAAa,cAC3BC,SACIC,eAAgB,oDAEpBhM,KAAMiL,2BAA4BjL,QAClCZ,KAAM,SAAU+M,QAChBjN,SAAUiN,OAAOnM,KAAK6N,UACvB,WACC3O,UAAU,QAItB4O,gBAAkB,SAAU5O,UACC,kBAAbA,YACRA,SAAW,cAEf4H,MAAQA,OAASf,UAAU3C,IAAK,SAChC6H,2BAA6BA,4BAA8BlF,UAAU3C,IAAK,8BAE1E7F,MAAM4F,QAAQC,KAAO,aAAc,kBAAoB,SAAUpD,MAC7D,MAAyB,QAApBA,KAAKwD,YAA2C4I,SAApBpM,KAAKwD,eAClCtE,WAAU,OAId4H,QACI+E,OAAQ,OACRjO,IAAK,gDACLmO,SACIC,eAAgB,oDAEpBhM,KAAMiL,4BACF8C,MAAO/N,KAAKwD,WACZwK,eAAgB,aAChBC,MAAO/B,mBAAoB1M,KAAKwN,UAAWT,KAAK2B,QAASlO,KAAKsM,eAAgB9M,KAAKwN,UAAW7P,WAAWiD,oBAE7GhB,KAAM,SAAU+M,QACXA,OAAOnM,KAAK6N,WAAY,GACI,cAAxB1B,OAAOnM,KAAKmO,SACbC,qBAEJlP,UAAU,EAAOiN,OAAOnM,KAAKmO,WAE7B5Q,MAAM4F,QAAQkJ,KAAO7I,WAAc2I,OAAOnM,KAAK+N,QAC/C7O,SAAUiN,OAAOnM,KAAK6N,WAE3B,WACC3O,UAAU,QAItBmP,uBAAyB,WACrB9Q,MAAM4F,QAAQwC,OAAQ,kBAEtBuF,YAAcA,aAAenF,UAAU3C,IAAK,eAC5C8H,YAAYoD,QACRzL,MAAO,4BACP0L,SAAU,6CACV7L,SAAU,8JACV8L,UAAW,WACXC,iBAAkB,aAClBrP,KAAM,SAAUmM,UAChBhO,MAAM4F,QAAQkJ,KACVC,eAAkBC,KAAKC,MAAMC,IAAIC,SAAUH,KAAKI,KAAKC,OAAOD,KAAMpB,aAEtExI,UAGRqL,mBAAqB,WACjB7Q,MAAM4F,QAAQwC,OAAQ,cAEtBuF,YAAcA,aAAenF,UAAU3C,IAAK,eAC5C8H,YAAYwD,SACR7L,MAAO,8BACPH,SAAU,4CACVtD,KAAM,SAAU+M,QACXA,QAEDhB,YAAa,SAAUgB,QACdA,UAAW,GACZpJ,YAOpB4L,aAAe,SAAUZ,OACrB,MAAOa,MAAMb,OAAQ7N,MAAO,KAAO,IAEvC2O,WAAa,WACT,GAAIxB,OAAQ9P,MAAM4F,QAAQC,KAAO,aAAc,kBAG/C,OAA0BgJ,UAArBiB,MAAM7J,YAAiD,OAArB6J,MAAM7J,aAKf4I,SAAzBiB,MAAMf,gBAAyD,OAAzBe,MAAMf,gBAgBzD,OATA/O,OAAM4F,QAAQC,KAAO,aAAc,kBAAoB,SAAUpD,MAEpC,OAApBA,KAAKwD,YAA2C4I,SAApBpM,KAAKwD,YAAoD4I,SAAxBpM,KAAKsM,gBAAwDF,SAAxBpM,KAAKsM,eACxGnP,WAAW0P,UAAW,EAEtB1P,WAAW0P,UAAW,KAK1B1B,YAAaA,YACbM,MAAOA,MACPqB,OAAQA,OACRpB,UAAWA,UACX3I,KAAMA,KACNoK,iBAAkBA,iBAClBJ,eAAgBA,eAChBU,eAAgBA,eAChBK,gBAAiBA,gBACjBO,uBAAwBA,uBACxBD,mBAAoBA,mBACpBO,aAAcA,aACdE,WAAYA,eAMxBlS,QAAQC,OAAQ,0BAA4B,mBAAoB,qBAE9DuD,WAAY,YAAa,SAAU2O,OAAQ3R,WAAYL,OAAQoO,YAAa1N,OAG5E,MAAKA,OAAMqR,iBACV/R,QAAOwG,GAAI,yBAIZwL,OAAO9O,QAEP8O,OAAOC,OAAS,WAETD,OAAO9O,KAAKsL,SAMLwD,OAAO9O,KAAKuL,SAOxB/N,MAAMiO,MAAOqD,OAAO9O,KAAKsL,SAAUwD,OAAO9O,KAAKuL,SAAU,SAAUY,QAClE,MAAkC,gBAAtBA,QAAOnM,KAAK0G,UACvBwE,aAAY8D,OACXtM,SAAU,qBAAuByJ,OAAOnM,KAAK0G,MAAQ,aAIvD5J,QAAOwG,GAAI,0BAXZ4H,YAAY8D,OACXtM,SAAU,+DAPXwI,YAAY8D,OACXtM,SAAU,qEAqBboM,OAAOG,UAAY,WAClBnS,OAAOwG,GAAI,6BAIZnD,WAAY,uBAAwB,SAAU2O,OAAQhS,OAAQK,WAAYG,SAAUF,QAAS8R,YAAahE,YAAaiE,cAAe5R,MAAOC,OAE7I,MAAMA,OAAMqR,cAMZrR,MAAMuF,OACN+L,OAAO9O,MACNoP,YAAY,GAGbN,OAAOO,YAAc9R,MAAM8R,YAE3BP,OAAOjJ,cAAgB,SAAUtE,OAChChE,MAAMsI,cAAetE,OAErB4N,cAAcG,iBACbC,aAAa,IAGdzS,OAAOwG,GAAI,aAGZwL,OAAO3B,iBAAmB,SAAU5L,OACnC,GAAImN,SAAUxD,YAAYwD,SACzB7L,MAAO,oBACPH,SAAU,iBAEXgM,SAAQtP,KAAM,SAAUoQ,KACvB,GAAKA,IAAM,CACV,GAAIpC,QAASjQ,WAAWiD,YAAamB,MACrC/D,OAAM2P,iBAAkBC,OAAQ,SAAUjB,QACzC,MAA6B,gBAAjBA,QAAOzF,UAClBwE,aAAY8D,OACXtM,SAAU,MAAQyJ,OAAOzF,MAAQ,UAI9BnJ,MAAMkS,uBAAyBlO,cAC5BpE,YAAWkG,iBAClB9F,MAAM4F,QAAQwC,OAAQ,qBAEvBxI,WAAWiD,YAAYsP,OAAQnO,MAAO,OACtChE,OAAM4F,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,sBAMjE0O,OAAOa,QAAU,SAAUC,WAC1B,MAAO,IAAIC,MAAMD,WAAYE,uBAG9BhB,OAAOiB,WAAa,WACnBvS,MAAMkO,mBArDN5O,QAAOwG,GAAI,WAyDZnD,WAAY,cAAe,SAAU2O,OAAQ1R,QAAS0J,MAAOvJ,OAC7D,GASG6I,SATC4J,aAAe,WACblJ,MAAMmJ,gBAAgBrN,OAAS,GACnCrF,MAAM2S,QAAS,SAAUC,OACxBrB,OAAOsB,OAAQD,OACf/J,QAAU8D,WAAY,WACrB8F,gBACE,QAKNlB,QAAOsB,OAAS,SAAUD,OACzB,GAAKA,MAAQ,CACZ,GAAIvI,GAAGyI,QAASC,GAIhB,KAFAxB,OAAOyB,SAAU,EAEX3I,EAAI,EAAGA,EAAIuI,MAAMvN,OAAQgF,IAC9ByI,QAAU,GAAIR,MAAwB,IAAlBM,MAAOvI,GAAK,IAAa4I,eAExCH,UAAYC,MAChBA,IAAMD,QACNF,MAAMT,OAAQ9H,EAAG,GAAK6I,UAAW,OAAQH,IAAKD,UAGhDvB,QAAO4B,KAAOP,UAEdrB,QAAOyB,SAAU,GAInBzB,OAAO5M,IAAK,yBAA0B,WACrC8N,iBAGDlB,OAAO5M,IAAK,yBAA0B,WACrCyO,aAAcvK,aAIfjG,WAAY,eAAgB,SAAU2O,OAAQhS,OAAQoO,YAAa3N,OACnEuR,OAAO8B,YAEP9B,OAAO+B,eAAiBtT,MAAMsT,eAC9B/B,OAAOgC,QAAUvT,MAAMwT,kBAEvBjC,OAAOC,OAAS,WACfxR,MAAMyT,YAAalC,OAAO8B,SAAU,SAAUT,OAC7C,GAAIvL,KAECuL,QACJvL,KAAO,+BACP9H,OAAOwG,GAAI,aAEXsB,KAAO,oFAERsG,YAAY8D,OACXtM,SAAU,qBAAuBkC,KAAO,YAK3CkK,OAAO5M,IAAK,yBAA0B,WACrC3E,MAAM0T,qBAAsB,SAAUd,OAChCA,OACJrB,OAAOyB,SAAU,QAGVJ,OAAMe,UACNf,OAAMgB,IACbrC,OAAO8B,SAAWT,OAElBrB,OAAOyB,SAAU,GAEhB,MAAM,OAIVpQ,WAAY,WAAY,SAAU2O,OAAQ3R,WAAYL,OAAQsU,kBAAmBlG,YAAamG,uBAAwB/T,SAAUC,MAAOC,OACvI,MAAMA,OAAMqR,cAKZC,OAAOwC,kBAAmD,IAA/B/T,MAAMkS,qBAEjCtS,WAAW+E,IAAK,oBAAqB,WACpC4M,OAAOwC,kBAAmD,IAA/B/T,MAAMkS,uBAGlCX,OAAOyC,kBAAoB,WAC1BH,kBAAkBnT,MACjBmN,UACGxG,KAAM,6DAET4M,UAAW,iBACXC,WAAY,SACZC,cAAe,SAAUnQ,OAUxB,MATe,KAAVA,OACJhE,MAAMuF,mBAAoB,SAAUqJ,QAC7BA,QACLjB,YAAY8D,OACXtM,SAAU,yMAGV,IAEG,WAOPoM,OAAO6C,UAAY,WACZN,uBAAuBO,YAAY,UAnC5C9U,QAAOwG,GAAI,WAuCZnD,WAAY,WAAY,SAAUhD,WAAY2R,OAAQ5D,YAAa9N,QAAS0J,MAAOxJ,SAAUC,OAC7F,GAQG6I,SARC4J,aAAe,WACblJ,MAAMmJ,gBAAgBrN,OAAS,GACnCrF,MAAMgG,iBAAkB,WACvB6C,QAAU8D,WAAY,WACrB8F,gBACE,QAKNlB,QAAOvO,WAAa,WACnB,GAAIgL,UAAWpO,WAAWkG,iBAAiBkI,QACzBa,UAAbb,UAAuC,KAAbA,SAC9BL,YAAYwD,SACX7L,MAAO,uBACPH,SAAU,4DACPtD,KAAM,SAAU+M,QACdA,SACJhP,WAAWkG,iBAAiBkI,SAAW,GACvChO,MAAMgD,WAAY,WACjB,GAAIgB,OAAQpE,WAAWiD,YAAYyR,SAAWzU,QAAS,UAAYD,WAAWiD,aAAeC,IAAOlD,WAAWkG,iBAAiBhD,WAAiB,GAC5IkB,SACJpE,WAAWiD,YAAamB,OAAUpE,WAAWkG,iBAC7C9F,MAAM4F,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAW7P,WAAWiD,aAAeiD,iBAAoB7D,KAAKwN,UAAW7P,WAAWkG,oBAC7HlG,WAAWqF,WAAY,4BAM3BjF,MAAMgD,WAAY,WACjB,GAAIgB,OAAQpE,WAAWiD,YAAYyR,SAAWzU,QAAS,UAAYD,WAAWiD,aAAeC,IAAOlD,WAAWkG,iBAAiBhD,WAAiB,GAC5IkB,SACJpE,WAAWiD,YAAamB,OAAUpE,WAAWkG,iBAC7C9F,MAAM4F,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAW7P,WAAWiD,aAAeiD,iBAAoB7D,KAAKwN,UAAW7P,WAAWkG,oBAC7HlG,WAAWqF,WAAY,0BAM3BsM,OAAOO,YAAc9R,MAAM8R,YAC3BP,OAAOgD,aAAevU,MAAMkS,qBAE5BX,OAAOiD,iBAAmB,SAAUvJ,WACnCmI,aAAcvK,QAEd,IAAIiK,SAAU9S,MAAMkS,qBACnBuC,GAAK3B,QAAU7H,SAEX6H,YAAY,GAAM2B,GAAK,GAAKA,IAAM7U,WAAWiD,YAAYwC,SAI9DkM,OAAOgD,aAAeE,GACtBzU,MAAMsI,cAAemM,GAAIhC,gBAG1BlB,OAAO5M,IAAK,yBAA0B,WACrCyO,aAAcvK,WAGf0I,OAAO5M,IAAK,yBAA0B8N,cAEtC7S,WAAW+E,IAAK,oBAAqB,WACpC4M,OAAOgD,aAAevU,MAAMkS,qBAC5BnS,SAAU,WACTwR,OAAOjP,eAKTM,WAAY,YAAa,SAAU2O,OAAQ3R,YAC3C,GAAI8U,OAAQ,WACXnD,OAAO/O,KACNmS,MAAQ1J,UAAW,QACnB2J,MAAQ3J,UAAW,UAEpBsG,OAAOzC,IAAK,QAGbyC,QAAOsD,UAAYC,MAAMC,SAASF,YAElCtD,OAAOzC,IAAM,SAAUrL,MACR,SAATA,KACJ8N,OAAOuB,QAAUvB,OAAO/O,IAAImS,KAE5BpD,OAAOuB,QAAUvB,OAAO/O,IAAIoS,MAI9BhV,WAAW+E,IAAK,oBAAqB+P,OACrCA,UAMFtV,QAAQC,OAAQ,uBACXmO,QAAS,SAAW,YAAa,aAAc,WAAY,aAAc,SAAUhF,UAAW5I,WAAY6N,SAAUuH,YAEvH,GAwcCzL,OAAOvB,GAAInI,QAAS8N,YAAagE,YAxc9BsD,UAAY,UAAUpO,KAAMvG,OAAOqD,UAAUmD,WAChDoO,KAAO,0BAA0BrO,KAAMvG,OAAOqD,UAAUmD,WAGlDlB,SACIC,IAAK,SAAUsP,MAAOxT,UAClBA,SAAWA,UAAY,YAEpB,IACI0I,GADA5H,OAGkB,iBAAV0S,SACRA,OAAUA,OAGd,KAAM9K,IAAK8K,OACFA,MAAMlF,eAAgB5F,KACvB5H,KAAM0S,MAAO9K,IAAQ+K,aAAaC,QAASF,MAAO9K,IAK1D,OADA1I,UAAUc,MACHA,MAEdqM,IAAK,SAAUqG,MAAOxT,UAClBA,SAAWA,UAAY,aACvBgM,YAAcA,aAAenF,UAAU3C,IAAK,cACzC,IAAIwE,EACJ,IAAsB,gBAAV8K,OACR,IAAM9K,IAAK8K,OACFA,MAAMlF,eAAgB5F,IACvB+K,aAAaE,QAASjL,EAAG8K,MAAO9K,GAK5C1I,WAAU,IAEjByG,OAAQ,SAAU+M,MAAOxT,UACrBA,SAAWA,UAAY,YACvB,IAAI0I,EACkB,iBAAV8K,SACzBA,OAAUA,OAEG,KAAM9K,IAAK8K,OACnBA,MAAMlF,eAAgB5F,IAC1B+K,aAAaG,WAAYJ,MAAO9K,GAGlC1I,WAAU,KAGV6T,QAAU,SAAUC,KACnB,MAASA,KAAM,IAAQ,KAAUA,IAAM,KAAO,GAAM,IAAQ,MAAYA,IAAM,KAAO,GAAM,KAAO,GAAM,IAAQ,OAAYA,IAAM,KAAO,GAAM,KAAO,GAAM,KAAO,IAE9JC,sBAAwB,SAAU/T,SAAUgU,GAAInF,OACrD,IAAMmF,KAAOnF,QAAU5Q,WAAWkG,iBAEjC,WADAnE,WAAU,EAIX4H,OAAQA,OAASf,UAAU3C,IAAK,QAEhC,IAAIiD,SACArG,MACHmT,QAAW,SACX3S,OAAU0L,mBAAoB6B,OAAS5Q,WAAWkG,iBAAiB7C,QACnE8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,UACpCC,GAAM,MAEHC,QAAUzF,QAAYmF,IAAQ/V,WAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,MAGpF,OAFT6F,SAAUkM,WAAWkB,KAAMD,QAASxT,MAEpBqG,QAAQjH,KACvB,SAAU+M,QACT,MAA2BC,UAAtBD,OAAOnM,KAAK0G,UAChBxH,WAAU,IAGXiN,OAAOnM,KAAK0T,YAAa,GAAI7D,OAAOF,cACpCzQ,UAAUiN,OAAOnM,QAElB,WACCd,UAAU,MAIP+R,qBAAuB,SAAU/R,SAAUgU,GAAIS,YACpD,IAAMxW,WAAWkG,iBAEhB,WADAnE,WAAU,EAIX,IAAImH,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,UACpCC,GAAM,MAIHC,SAAWN,IAAQ/V,WAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,MAGzE,OAFT6F,SAAUkM,WAAWkB,KAAMD,QAASxT,KAAM2T,YAE1BtN,QAAQjH,KACtB,SAAU+M,QACT,MAA2BC,UAAtBD,OAAOnM,KAAK0G,UAChBxH,WAAU,GAGYkN,SAAlBD,OAAOnM,KAAK4T,GAAqC,KAAlBzH,OAAOnM,KAAK4T,MAC/C1U,WAAU,OAGXA,UAAUiN,OAAOnM,OAElB,WACCd,UAAU,MAIRqE,iBAAmB,SAAUrE,UAClCqG,GAAKA,IAAMQ,UAAU3C,IAAK,MAC1BhG,QAAUA,SAAW2I,UAAU3C,IAAK,WACpClE,SAAWA,UAAY,YACvB,IAKImH,SALAlG,WAAaxD,QAAQkX,KAAM1W,WAAWkG,kBACtCyQ,KAAO,SAAU9T,MACnB7C,WAAW2E,WAAY,EACvBnF,QAAQoX,OAAQ5T,WAAYH,MAI7BqG,SADuB+F,SAAnBjM,WAAW6T,IACLzO,GAAG0O,OACZ7U,KAAM,WAAa,MAAO6T,uBAAuBa,QACjD1U,KAAM,WAAa,MAAO6R,sBAAsB6C,QAEvCvO,GAAG0O,OACZ7U,KAAM,WAAa,MAAO6T,uBAAuBa,QAEnDzN,QAAQjH,KAAM,WACb,GAAImC,OAAQkO,oBAEPlO,QAAS,GAAKpB,WAAWE,MAAQlD,WAAWkG,iBAAiBhD,MACjElD,WAAWiD,YAAamB,OAAUpB,WAClChD,WAAWkG,iBAAmBlD,WAC9BhD,WAAWqF,WAAY,qBACvBW,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAW7P,WAAWiD,aAAeiD,iBAAoB7D,KAAKwN,UAAW7P,WAAWkG,qBAGxHnE,cAGIuQ,mBAAqB,SAAUpP,KACpC,IAAMlD,WAAWkG,mBAAqBhD,IACrC,MAAO,KAGRA,KAAMA,MAAyC,OAAhClD,WAAWkG,iBAA4B,GAAKlG,WAAWkG,iBAAiBhD,IAEvF,KAAM,GAAIuH,GAAI,EAAGA,EAAIzK,WAAWiD,YAAYwC,OAAQgF,IACnD,GAAKzK,WAAWiD,YAAawH,GAAIvH,MAAQA,IACxC,MAAOuH,EAGT,OAAO,OAEF/B,cAAgB,SAAU1F,WAAYjB,UAC3CA,SAAWA,UAAY,aAEvBgV,oBACA/W,WAAWkG,iBAAyC,gBAAflD,YAA0BA,WAAahD,WAAWiD,YAAaD,YACpGhD,WAAW2E,WAAY,EACvByB,mBACAJ,QAAQkJ,KAAOhJ,iBAAkB7D,KAAKwN,UAAW7P,WAAWkG,mBAAsBnE,UAClF0B,oBAEDuT,cAAgB,SAAUnU,KAAMd,UAI/B,MAHAA,UAAWA,UAAY,aACvBgM,YAAcA,aAAenF,UAAU3C,IAAK,eAEtCpD,KAAK+N,OAAY/N,KAAKkT,IAAOlT,KAAKuL,SAQnCvL,KAAK+N,OAA+B,KAAtB/N,KAAK+N,MAAMnL,QAC7BsI,YAAY8D,OACXtM,SAAU,uGAEXxD,WAAU,QAIX+T,uBAAuB,SAAU9G,QAQhC,GAPMA,SACLjB,YAAY8D,OACXtM,SAAU,8FAEXxD,UAAU,IAGNiN,OAAO9L,IAAM,CAMjB,GALA8L,OAAO+G,GAAKlT,KAAKkT,GACjB/G,OAAOZ,SAAWvL,KAAKuL,SAEvBnO,QAAUA,SAAW2I,UAAU3C,IAAK,WAE/BhG,QAAS,UAAYD,WAAWiD,aAAeC,IAAO8L,OAAO9L,MAAQuC,OAAS,EAKlF,MAJAsI,aAAY8D,OACXtM,SAAU,iEAEXxD,WAAU,EAIX+R,sBAAsB,SAAUd,OAC/BxT,QAAQoX,OAAQ5H,OAAQgE,OACxBhT,WAAWiD,YAAYqC,KAAM0J,QAC7BhJ,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,eACvDjD,WAAWqF,WAAY,sBACvBtD,UAAU,IACRc,KAAKkT,IAGJlT,KAAK+N,OACTjH,OACC+E,OAAQ,OACRjO,IAAK,gDACOmO,SAAWC,eAAgB,oDACvChM,KAAM,0BAA4BA,KAAK+N,MAAQ,UAC/CxH,gBAAgB,IACbnH,KAAM,SAAU+Q,OACnB,MAAoB,mBAAfA,MAAMnQ,MACVkL,YAAY8D,OACXtM,SAAU,mDAEXxD,WAAU,KAIXiR,MAAQA,MAAMnQ,KAAK2C,MAAMzC,MAAO,KAAO,GAAIA,MAAO,KAAO,GACzDiM,OAAO9L,IAAM,YAAc8P,MAAMlK,MAAO,WAAYmO,KAAM,KAC1DjI,OAAO3K,KAAOxB,KAAK+N,MAEd3Q,QAAS,UAAYD,WAAWiD,aAAeC,IAAO8L,OAAO9L,MAAQuC,OAAS,GAClFsI,YAAY8D,OACXtM,SAAU,iEAEXxD,WAAU,KAIX/B,WAAWiD,YAAYqC,KAAM0J,QAC7BhJ,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,eACvDjD,WAAWqF,WAAY,0BACvBtD,WAAU,QAIbc,KAAK+N,MAAQ,KAAO/N,KAAKkT,GACzBlT,KAAK+N,MAAQ/N,KAAK+N,MAAQ,OAlFzB7C,YAAY8D,OACXtM,SAAU,oEAEXxD,WAAU,KAkFZ4D,mBAAqB,SAAU5D,SAAUqH,gBACxCO,MAAQA,OAASf,UAAU3C,IAAK,SAChClE,SAAWA,UAAY,aACvBgQ,YAAcA,aAAenJ,UAAU3C,IAAK,eAEnC0D,OACI+E,OAAQ,MACRjO,IAAKoN,SAASqJ,UAAY,MAC1B9N,eAA0C,mBAAnBA,iBAAiCA,eACpEH,QAAS,IACTE,WAAY,IACAlH,KACZ,SAAU+M,QACT,IAAMA,OAAOnM,KAAKsU,MAEjB,WADApV,WAAU,EAIX,IAAIkD,OAAQjF,WAAWkF,MACvBD,OAAMpC,QACNoC,MAAM0R,KAAO,WACZ1R,MAAMmS,MAAM3S,OACZ4S,qBAAsBpS,MAAMpC,OAE7BoC,MAAMkS,MAAQnI,OAAOnM,KAAKsU,MAC1BpF,YAAYuF,gBAAiB,qCAC5BrS,MAAOA,MACPsS,UAAW,gBACRtV,KAAM,SAAUmV,OACnBnS,MAAMmS,MAAQA,MACdA,MAAMtW,SAEPiB,UAAU,IAEX,WACCA,UAAU,MAIbsV,qBAAuB,SAAUxU,MAChC8G,MAAQA,OAASf,UAAU3C,IAAK,SAChC8H,YAAcA,aAAenF,UAAU3C,IAAK,eAC5CD,QAAQC,IAAK,aAAc,SAAUiK,OACpC,GAAI7L,MAAO,SAAW6L,MAAM7J,UAC5BsD,QACa+E,OAAQ,MACRjO,IAAKoN,SAASqJ,UAAY,WAAanI,mBAAoBlM,KAAK2U,MAAS,SAAWzI,mBAAoBlM,KAAKuL,UAAa/J,OAC1HpC,KACZ,SAAU+M,QACmB,IAAvBA,OAAOnM,KAAKmM,OAChBjC,WAAY0K,kBAAmB,KAE/B1J,YAAY8D,OACXtM,SAAU,+EACPtD,KAAM0D,qBAGZ,WACCoI,YAAY8D,OACXtM,SAAU,wEACPtD,KAAM0D,yBAKd8R,kBAAoB,WACnB9N,MAAQA,OAASf,UAAU3C,IAAK,SAChC8H,YAAcA,aAAenF,UAAU3C,IAAK,eAEnC0D,OACI+E,OAAQ,MACRjO,IAAK,0BACLwB,KAAM,SAAU+M,QAC5B,MAAwB,KAAnBA,OAAOnM,KAAKkT,OAChBhI,aAAY8D,OACXtM,SAAU,gHAKZwI,YAAY8D,OACXtM,SAAU,kGAGXvF,WAAWiD,YAAYqC,MACtByQ,GAAIH,QAAS5G,OAAOnM,KAAKkT,IACzB3H,SAAU,WACVmC,KAAM,kBAEPvK,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,mBACvDjD,YAAWqF,WAAY;IAGzBqS,iBAAmB,SAAU3V,UAC5B,MAAMrB,QAAOiX,qBAKbjX,QAAOiX,iBAAiBC,aAAc,SAAUC,QAC/C,IAAMA,OAEL,WADA9V,WAAU,EAIXqG,IAAKA,IAAMQ,UAAU3C,IAAK,MAC1B0D,MAAQA,OAASf,UAAU3C,IAAK,SAChC4R,OAASA,OAAO9U,MAAO,KACvB8U,OAAOrS,KAEP,IAkB2BiF,GAlBvBqN,OAASD,OAAOZ,KAAM,KACzBc,MAAQ,SAAUhC,IACjB,MAAOpM,QACL+E,OAAQ,MACRjO,IAAK,UAAYqX,OAAS,IAAM/B,GAAK,MACrC3M,gBAAgB,EAChBH,QAAS,IACTE,WAAY,IAEZlH,KAAM,SAAU+M,QACXA,OAAOnM,MAAQmM,OAAOnM,KAAKK,KAC/B8U,QAAQ1S,KAAMwS,OAAS,IAAM/B,MAG9BkC,MAAO,WACP,OAAO,KAGVC,SAAYF,UAIV,KAFHhY,WAAWqF,WAAY,gBAEdoF,EAAI,EAAGA,GAAK,IAAKA,IACnByN,MAAM5S,KAAMyS,MAAOtN,GAGvBrC,IAAG+P,IAAKD,OAAQjW,KAAM,WACxBjC,WAAWqF,WAAY,gBACvBtD,SAAUiW,iBA3CXjW,WAAU,IA+CZqW,gBAAkB,SAAUrW,UAC3BgM,YAAcA,aAAenF,UAAU3C,IAAK,eAE5C8H,YAAYoD,QACXzL,MAAO,4BACPH,SAAU,0CACV8L,UAAW,WACXC,iBAAkB,wBACfrP,KAAM,SAAUmM,UACnBrM,SAAUqM,aAGZ3K,iBAAmB,WACZ/C,OAAO8C,eAIb9C,OAAO8C,cAAc5C,YAAa,SAAUA,aAC3C,GAAMA,aAAgBZ,WAAWiD,YAAYwC,OAA7C,CAOA,IAAM,GAHF4S,UACHC,MAAQtY,WAAWiD,YAAYwC,OAAS,EAAIzF,WAAWiD,YAAYwC,OAAS,EAEnEgF,EAAI,EAAGA,EAAI6N,MAAO7N,IAC3B4N,MAAM/S,MACLzB,KAAM,UAAY7D,WAAWiD,YAAawH,GAAIvH,IAC9CwC,MAAO,UAAY1F,WAAWiD,YAAawH,GAAI8F,KAC/CgI,SAAU,UAIZ7X,QAAO8C,cAAcgV,sBAAuBH,WAG9CtB,kBAAoB,WACnBpN,MAAQA,OAASf,UAAU3C,IAAK,SAEhC0D,MAAMmJ,gBAAgBnQ,QAAS,SAAU8V,YACnCA,WAAW1P,QACf0P,WAAW1P,OAAO3D,YAiBnB,OAXKiQ,aACPqD,YAAYC,UAAUC,MAAQ,WAC7B,GAAIC,KAAMC,KAAKC,cAAcC,YAAa,cAC1CH,KAAII,eAAgB,SAAS,GAAM,EAAMH,KAAKC,cAAcG,YAAa,EAAG,EAAG,EAAG,EAAG,GAAG,GAAO,GAAO,GAAO,EAAO,EAAG,MACvHJ,KAAKK,cAAeN,OAIhB7Y,WAAW+E,IAAK,qBAAsBtB,mBAI3C6R,KAAMA,KACAtP,QAASA,QACT8P,sBAAuBA,sBACvBhC,qBAAsBA,qBACtB1N,iBAAkBA,iBAClBsC,cAAeA,cACf4J,mBAAoBA,mBACpB3M,mBAAoBA,mBACpBlC,iBAAkBA,iBACxB2Q,kBAAmB,SAAUrS,UAC5BA,SAAWA,UAAY,aACvBgM,YAAcA,aAAenF,UAAU3C,IAAK,cAE5C,IAAIhB,OAAQjF,WAAWkF,MACvBD,OAAMpC,MACLuW,UAAS1Y,OAAOiX,kBAEjB1S,MAAMoU,KAAO,WACZ3B,iBAAkB,SAAU1I,QAC3B,MAAMA,SAAWA,OAAOvJ,YAOxBR,MAAMpC,KAAKyW,iBAAmBtK,YAN7BjB,aAAY8D,OACXtM,SAAU,iEAQdN,MAAM0R,KAAO,SAAUZ,IACtBwD,MAAMC,QACNpB,gBAAiB,SAAUhK,UAC1B4I,eACCjB,GAAIA,GACJ3H,SAAUA,aAKb,IAAImL,OAAQxL,YAAYjN,MACvBiH,YAAa,+BACbrC,MAAO,iBACPT,MAAOA,MACPgJ,UACGxG,KAAM,WAEPA,KAAM,aACN5D,KAAM,kBACNqK,MAAO,SAAUlJ,GAChB,SAAMC,MAAMpC,KAAKkT,KAAO9Q,MAAMpC,KAAKuL,eAClCpJ,GAAEe,qBAUPwT,OAAMtX,KACL,SAAUoM,SACJA,SACJ2I,cAAe/R,MAAMpC,KAAMd,aAK/B0X,aAAc,SAAU1X,UACvBA,SAAWA,UAAY,aACvBgM,YAAcA,aAAenF,UAAU3C,IAAK,eAE5C8H,YAAYoD,QACXzL,MAAO,0BACPH,SAAU,qCACV8L,UAAW,OACXC,iBAAkB,0BACfrP,KAAM,SAAU2O,OACdA,OACJoG,eAAiBpG,MAAOA,OAAS7O,aAIpCqB,WAAY,SAAUiB,KAAMtC,UACN,kBAATsC,QACXtC,SAAWsC,KACXA,KAAO,MAGRtC,SAAWA,UAAY,YAEvB,IAAImH,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,MAAUuD,EAAK,QAASC,KAAQ5K,mBAAoB/O,WAAWkG,iBAAiBkI,aACpHgI,GAAM,KAEF/R,OAAUrE,WAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,OACzE6F,QAAUkM,WAAWkB,MAAM,EAAMzT,OAEjCA,KAAKuN,QAAWuJ,KAAQ5K,mBAAoB/O,WAAWkG,iBAAiBkI,UAAYwK,MAAS,GAC7F1P,QAAUkM,WAAWkB,MAAM,EAAOzT,OAG1BqG,QAAQjH,KAChB,WACCF,UAAU,IAEX,WACCA,UAAU,MAIb6R,kBAAmB,WAClB7F,YAAcA,aAAenF,UAAU3C,IAAK,eAEvCjG,WAAWkG,kBACf6H,YAAYwD,SACX7L,MAAO,sBACPH,SAAU,2EACPtD,KAAM,SAAU+M,QACnB,GAAKA,OAAS,CACbrF,MAAQA,OAASf,UAAU3C,IAAK,QAEhC,IAAIiD,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,MAAUuD,EAAK,SAAUC,KAAQ5K,mBAAoB/O,WAAWkG,iBAAiBkI,aACrHgI,GAAM,KASP,OAPKpW,YAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,OAC/D6F,QAAUkM,WAAWkB,MAAM,EAAMzT,OAEjCA,KAAKuN,QAAWuJ,KAAQ5K,mBAAoB/O,WAAWkG,iBAAiBkI,UAAYwL,OAAU,GAC9F1Q,QAAUkM,WAAWkB,MAAM,EAAOzT,OAG5BqG,QAAQjH,KAAM,SAAU+M,QACFC,SAAvBD,OAAOnM,KAAKmM,QAA+C,IAAvBA,OAAOnM,KAAKmM,OACpDjB,YAAY8D,OAASnM,MAAO,kCAAoCrD,KAAKwN,UAAWb,UAEhFjB,YAAY8D,OAASnM,MAAO,4BAOlCmO,YAAa,SAAUJ,SAAU1R,UAChC,GAAImH,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,KAAQ1C,WAC5C2C,GAAM,KAUE,OARJpW,YAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,OAC/D6F,QAAUkM,WAAWkB,MAAM,EAAMzT,OAEjCA,KAAKuN,OAASqD,SACd5Q,KAAKuN,OAAOuJ,KAAO5K,mBAAoB/O,WAAWkG,iBAAiBkI,UACnElF,QAAUkM,WAAWkB,MAAM,EAAOzT,OAGnBqG,QAAQjH,KACvB,SAAU+M,QAERjN,SADIvC,QAAQkL,OAAQsE,OAAOnM,UACjB,EAEAmM,OAAOnM,OAGnB,WACCd,UAAU,MAIb2R,eAAgB,WACf3F,YAAcA,aAAenF,UAAU3C,IAAK,cAE5C,IAAIhB,OAAQjF,WAAWkF,MACvBD,OAAM4U,OAEN9L,YAAYjN,MACXiH,YAAa,gCACbrC,MAAO,kBACPT,MAAOA,MACPgJ,UACGxG,KAAM,WAEPA,KAAM,YACN5D,KAAM,sBAGL5B,KAAM,WACT,GAAMgD,MAAM4U,IAAIC,MAAS7U,MAAM4U,IAAIE,MAAQ9U,MAAM4U,IAAIC,OAAS7U,MAAM4U,IAAIE,KAAxE,CAGA9U,MAAM4U,IAAIF,KAAO5K,mBAAoB/O,WAAWkG,iBAAiBkI,SAEjE,IAAIlF,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,KAAQlR,MAAM4U,MAClDzD,GAAM,KAEFpW,YAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,OAC/D6F,QAAUkM,WAAWkB,MAAM,EAAMzT,OAEjCA,KAAKuN,OAASnL,MAAM4U,IACpB3Q,QAAUkM,WAAWkB,MAAM,EAAOzT,OAGnCqG,QAAQjH,KAAM,SAAU+M,QACvB,GAA2BC,SAAtBD,OAAOnM,KAAK0G,MAIhB,WAHAwE,aAAY8D,OACXtM,SAAU,qBAAuByJ,OAAOnM,KAAK0G,MAAQ,QAKvDvJ,YAAWkG,iBAAiBkI,SAAWnJ,MAAM4U,IAAIC,IAEjD,IAAI1V,OAAQpE,WAAWiD,YAAYyR,SAAWzU,QAAS,UAAYD,WAAWiD,aAAeC,IAAOlD,WAAWkG,iBAAiBhD,WAAiB,GAC5IkB,SACJpE,WAAWiD,YAAamB,OAAUpE,WAAWkG,iBAC7CF,QAAQkJ,KAAOjM,YAAeZ,KAAKwN,UAAW7P,WAAWiD,aAAeiD,iBAAoB7D,KAAKwN,UAAW7P,WAAWkG,oBACvHlG,WAAWqF,WAAY,uBAGxB0I,YAAY8D,OACXtM,SAAU,8DAKdwN,QAAS,SAAUhR,UAClB,IAAM/B,WAAWkG,iBAEhB,WADAnE,WAAU,EAIX4H,OAAQA,OAASf,UAAU3C,IAAK,QAChC,IAAIiD,SACArG,MACHmT,QAAW,SACX3S,OAAUrD,WAAWkG,iBAAiB7C,OACtC8M,SAAYnQ,WAAWkG,iBAAiBiK,SACxC8F,IAAO5T,KAAKwN,WAAaqG,EAAK,KAAMC,UACpCC,GAAM,MAEHC,QAAUrW,WAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,MAGhE,OAFT6F,SAAUkM,WAAWkB,KAAMD,QAASxT,MAEpBqG,QAAQjH,KACvB,SAAU+M,QACT,MAAKhP,YAAWkG,kBAAoBlG,WAAWkG,iBAAiB7C,QACpC4L,SAAtBD,OAAOnM,KAAK0G,UAChBxH,WAAU,OAIZA,UAAUiN,OAAOnM,KAAK0Q,KAAKyG,KAAM,SAAUC,EAAGC,GAAM,MAAOA,GAAG,GAAMD,EAAG,OAExE,WACClY,UAAU,MAIbmQ,YAAa,SAAUiI,OAAQ/V,MAAOgW,aACrCrI,YAAcA,aAAenJ,UAAU3C,IAAK,cAE5C,IAAIhB,OAAQjF,WAAWkF,OACtBmV,UAAY7a,QAAQiC,QAAS8E,SAASC,eAAgB,eA6BvD,OA3BAvB,OAAMpC,MACLyX,OAAO,EACPC,SAAS,EACTnW,OAAO,GAGRa,MAAMuV,YAAc,SAAUpW,OAC7Ba,MAAMwV,KAAKhW,OAEN6N,uBAAyBlO,QAC7BpE,WAAWkG,iBAAiBoU,MAAQrV,MAAMpC,KAAK0X,QAC/CvU,QAAQkJ,KAAOhJ,iBAAkB7D,KAAKwN,UAAW7P,WAAWkG,qBAG7DlG,WAAWiD,YAAamB,OAAQkW,MAAQrV,MAAMpC,KAAK0X,QAC7CvU,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,eACvDjD,WAAWqF,WAAY,uBAG9B0M,YAAYuF,gBAAiB,uBAC5BrS,MAAOA,QACJhD,KAAM,SAAUmV,OACnBnS,MAAMwV,KAAOrD,QAGd+C,OAAOO,kBAEFN,aACC9H,uBAAyBlO,cACtBpE,YAAWkG,iBAAiBoU,MACnCtU,QAAQkJ,KAAOhJ,iBAAkB7D,KAAKwN,UAAW7P,WAAWkG,2BAGtDlG,YAAWiD,YAAamB,OAAQkW,MACjCtU,QAAQkJ,KAAOjM,YAAaZ,KAAKwN,UAAW7P,WAAWiD,mBACvDjD,YAAWqF,WAAY,wBAI9BgV,UAAUM,SAAU,GAAI7F,QAExBuF,UAAUO,IAAK,SAAU,WACxB,GAAIC,MAAOR,UAAW,GAAIS,MAAO,EAEjC,IAAMD,KAAKhX,MAASgX,KAAKhX,KAAKiF,MAAO,WAArC,CAIA,GAAIiS,QAAS,GAAIC,WACjBD,QAAOE,OAAS,SAAUpC,KACzB5T,MAAMpC,KAAKyX,MAAQzB,IAAIqC,OAAOlM,OAC9B/J,MAAMpC,KAAKuB,MAAQA,MACnBa,MAAMwV,KAAK3Z,QAEZia,OAAOI,cAAeN,aAGvBR,WAAW,GAAIzB,cAKlBhL,QAAS,cAAgB,YAAa,aAAc,WAAY,SAAUhF,UAAW5I,WAAY6N,UAEjG,GA6BGlE,OAAOvB,GA7BNkO,KAAO,SAAUD,QAASxT,MAC7B,GAAIqG,QA2BJ,OA1BAS,OAAQA,OAASf,UAAU3C,IAAK,SAChCmC,GAAKA,IAAMQ,UAAU3C,IAAK,MAEzBiD,QADImN,QACM1M,MAAMyR,KAAMvN,SAASc,WAAa,iCAAkC9L,MAC7EZ,KAAM,SAAU+M,QAChB,GAAIqM,UAAWjT,GAAGY,OASlB,OARuBiG,UAAlBD,OAAOnM,KAAK4T,IACO,KAAlBzH,OAAOnM,KAAK4T,EAChBzH,OAAOnM,KAA6BoM,SAAtBD,OAAOnM,KAAK0G,MAAsByF,OAAOnM,KAAK0G,SAE5DyF,OAAOnM,KAAOR,KAAKC,MAAO0M,OAAOnM,KAAK4T,IAGxC4E,SAASjW,QAAS4J,QACXqM,SAASnS,UAGPS,OACT+E,OAAQ,MACRjO,IAAK,UAAYT,WAAWkG,iBAAiBuK,OAAS,IAAM5N,KAAKuT,GACjEhG,OAAQvN,KAAKuN,OACbkL,gBAAiB,6BACjBlS,gBAAgBpJ,WAAWkG,iBAAiBuK,SAO/C,QACC6F,KAAMA,SAIP1I,QAAS,YAAc,WACtB,GAAI2N,QAAS,qBAEb,QACE5M,WAAY,UAAY4M,OACxBC,gBAAiB,QAAUD,OAC3BrE,UAAW,qBACXuE,KAAM,cAOVjc,QAAQC,OAAQ,uBACXmO,QAAS,SAAW,YAAa,aAAc,SAAUhF,UAAW5I,YAEvE,GAAIuE,SAAU,WACuB0K,SAAtBvO,OAAOoD,YAIZpD,OAAOoD,WAAW4X,aACdhW,MAAO,aACPiW,OACIC,MAAO,qBACPC,MAAO,UACPC,MACIC,KAAM,KAGdC,OACIja,SAAU,oBACVka,MAAO,EACPC,KAAMC,kBAIlBA,YAAc,WACV,GAAID,QAoCJ,OAlCAlc,YAAWiD,YAAYN,QAAS,SAAUK,YAClD,GAAIqH,OACYxG,KAAM,6BACN2M,OACI4L,gBAAiB,UACjBC,aAAc,GAElBV,OACIC,MAAO,IAAM5Y,WAAWuN,MAIhC,IAAKvN,WAAWsX,MAAQ,CAEnC,GAAIgC,QAAS/V,SAASgW,cAAe,UACpCC,IAAMF,OAAOG,WAAY,MACzBC,IAAM,GAAIC,MAEXD,KAAIE,IAAM5Z,WAAWsX,MAErBgC,OAAO5V,MAAQ,GACf4V,OAAOO,OAAS,GAChBL,IAAIM,UAAWJ,IAAK,EAAG,EAAGJ,OAAO5V,MAAO4V,OAAOO,QAE/CxS,KAAK0S,WACcla,KAAMyZ,OAAOU,UAAW,aACxBtW,MAAO4V,OAAO5V,MACdmW,OAAQP,OAAOO,QAIvBX,KAAK5W,KAAM+E,QAGR6R,KAKX,OAFAlc,YAAW+E,IAAK,qBAAsBR,UAGlCA,QAASA","file":"app.min.js","sourcesContent":["/* global angular, google */\n\n// OpenGarage\n// Controllers are found in controllers.js and utilities are located in utils.js\nangular.module( \"opengarage\", [ \"ionic\", \"uiCropper\", \"opengarage.controllers\", \"opengarage.utils\", \"opengarage.cloud\", \"opengarage.watch\" ] )\n\t.run( function( $state, $ionicPlatform, $ionicScrollDelegate, $document, $window, $rootScope, $filter, $ionicLoading, $timeout, Utils, Cloud, Watch ) {\n\n\t\t// Ready function fires when the DOM is ready and after deviceready event is fired if Cordova is being used\n\t\t$ionicPlatform.ready( function() {\n\n\t\t\t// Map inAppBrowser to rootScope\n\t\t\t$rootScope.open = function( url ) {\n\t\t\t\tif ( window.SafariViewController ) {\n\t\t\t\t\twindow.SafariViewController.isAvailable( function( available ) {\n\t\t\t\t\t\tif ( available ) {\n\t\t\t\t\t\t\twindow.SafariViewController.show( {\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\ttintColor: \"#444444\",\n\t\t\t\t\t\t\t\tbarColor: \"#444444\",\n\t\t\t\t\t\t\t\tcontrolTintColor: \"#ffffff\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n\t\t\t// for form inputs)\n\t\t\tif ( window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard && window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar ) {\n\t\t\t\twindow.cordova.plugins.Keyboard.hideKeyboardAccessoryBar( true );\n\t\t\t}\n\t\t\tif ( window.StatusBar ) {\n\n\t\t\t\t// Use white text/icons on the status bar\n\t\t        window.StatusBar.styleLightContent();\n\n\t\t        //Change the status bar color to match the header\n                window.StatusBar.backgroundColorByHexString( \"#444\" );\n\n\t\t        // Scroll to the top of the page when the status bar is tapped\n\t\t\t\tangular.element( $window ).on( \"statusTap\", function() {\n\t\t\t\t\t$ionicScrollDelegate.scrollTop();\n\t\t        } );\n\t\t\t}\n\n\t\t\tif ( window.geofence ) {\n\t\t\t\t$rootScope.hasGeofence = true;\n\n\t\t\t\t$rootScope.startGeofence = function( callback ) {\n\t\t\t\t\twindow.geofence.initialize().then( function() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t} );\n\n\t\t\t\tvar handleGeofence = function( geofences ) {\n\t\t\t\t\tif ( geofences ) {\n\n\t\t\t\t\t\t// Allow handler to process notification click event as well\n\t\t\t\t\t\tif ( geofences.notification ) {\n\t\t\t\t\t\t\tgeofences = [ geofences ];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$apply( function() {\n\t\t\t\t\t\t\tgeofences.forEach( function( geo ) {\n\t\t\t\t\t\t\t\tvar data = geo.notification.id.split( \"-\" ),\n\t\t\t\t\t\t\t\t\tcontroller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\n\t\t\t\t\t\t\t\tif ( controller &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"open\" && controller.door === 0 ) &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"close\" && controller.door === 1 ) ) {\n\t\t\t\t\t\t\t\t\t\tUtils.toggleDoor( controller.apikey );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.onTransitionReceived = handleGeofence;\n\t\t\t\twindow.geofence.onNotificationClicked = handleGeofence;\n\t\t\t}\n\n\t\t\tif ( window.ThreeDeeTouch ) {\n\t\t\t\tUtils.updateQuickLinks();\n\n\t\t\t\twindow.ThreeDeeTouch.enableLinkPreview();\n\n\t\t\t\twindow.ThreeDeeTouch.onHomeIconPressed = function( payload ) {\n\n\t\t\t\t\tvar data = payload.type.split( \"-\" );\n\n\t\t\t\t\tif ( data[ 0 ] === \"toggle\" ) {\n\t\t\t\t\t\tvar controller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\t\t\t\t\t\tif ( controller ) {\n\t\t\t\t\t\t\tUtils.toggleDoor( controller.apikey );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( window.applewatch && window.navigator.simulator !== true ) {\n\t\t\t\twindow.applewatch.init( angular.noop );\n\n\t\t\t\twindow.toggleDoorByIndex = function( index ) {\n\t\t\t\t\tUtils.toggleDoor( $rootScope.controllers[ index ].auth );\n\t\t\t\t};\n\n\t\t\t\twindow.applewatch.callback.onLoadAppMainRequest = Watch.loadApp;\n\t\t\t}\n\n\t\t    // Hide the splash screen after 500ms of the app being ready\n\t\t    $timeout( function() {\n\t\t        try {\n\t\t            navigator.splashscreen.hide();\n\t\t        } catch ( err ) {}\n\t\t    }, 500 );\n\t\t} );\n\n\t\t// Define connected state of current controller\n\t\t$rootScope.connected = false;\n\n\t\t// Define version, build number and debug state\n\t\t$rootScope.version = window.appVersion;\n\n\t    // Define total loading requests\n\t    $rootScope.loadingQueue = [];\n\n\t    // Initialize controllers array\n\t    $rootScope.controllers = [];\n\n\t\t// Automatically show a loading message on any AJAX request\n\t\t$rootScope.$on( \"loading:show\", function( e, data ) {\n\t\t\tvar scope = $rootScope.$new();\n\n\t\t\tscope.canceller = data ? data.canceller.resolve : function() {\n\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t};\n\n\t\t\t$rootScope.loadingQueue.push( scope.canceller );\n\t\t\t$ionicLoading.show( {\n\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\tscope: scope\n\t\t\t} );\n\t\t} );\n\n\t\t// Automatically hide the loading message after an AJAX request\n\t\t$rootScope.$on( \"loading:hide\", function() {\n\n\t\t\t$rootScope.loadingQueue.pop();\n\t\t\t$ionicLoading.hide();\n\t\t\tif ( $rootScope.loadingQueue.length > 0 ) {\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.canceller = $rootScope.loadingQueue[ $rootScope.loadingQueue.length - 1 ];\n\t\t\t\t$ionicLoading.show( {\n\t\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\t\tscope: scope\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\t// Keep the page title locked as the app name\n\t\t$rootScope.$on( \"$ionicView.afterEnter\", function() {\n\t\t\t$document[ 0 ].title = \"OpenGarage\";\n\t\t} );\n\n\t\tangular.element( $document ).on( \"resume\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\tUtils.checkNewController();\n\t\t\t\tCloud.sync();\n\t\t\t}, 100 );\n\t\t} );\n\n\t\t// Handle loading of the first page\n\t\tvar firstLoadHandler = $rootScope.$on( \"$stateChangeStart\", function( event ) {\n\n\t\t\t// Unbind event handler so this check is only performed on the first app load\n\t\t    firstLoadHandler();\n\n\t\t    // Prevent any page change from occurring\n\t        event.preventDefault();\n\n\t\t    Utils.storage.get( [ \"activeController\", \"controllers\", \"cloudToken\" ], function( data ) {\n\n\t\t\t\ttry {\n\t\t\t\t\t$rootScope.controllers = JSON.parse( data.controllers );\n\t\t\t\t\t$rootScope.activeController = JSON.parse( data.activeController );\n\t\t\t\t} catch ( err ) {}\n\n\t\t\t\tif ( !$rootScope.controllers ) {\n\t\t\t\t\t$rootScope.controllers = [];\n\t\t\t\t}\n\n\t\t\t\tCloud.sync();\n\n\t\t\t\t// Restore the active controller, if available\n\t\t        if ( $rootScope.activeController && typeof $rootScope.activeController === \"object\" ) {\n\n\t\t\t\t\t// If a user object is cached, proceed to load the app while updating user object in the background\n\t\t\t\t\t$state.go( \"app.home\" );\n\n\t\t\t\t\tUtils.updateController();\n\t\t        } else {\n\t\t\t\t\tif ( $rootScope.controllers.length || data.cloudToken ) {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"login\" );\n\t\t\t\t\t}\n\t\t        }\n\t\t    } );\n\n\t\t    Utils.checkNewController();\n\t\t} );\n\n\t\t// Resize the main content view to fit when the window changes size\n\t\tangular.element( window ).on( \"resize\", function() {\n\t\t\t$rootScope.$broadcast( \"window:resize\" );\n\t\t\tvar content = document.getElementById( \"mainContent\" );\n\t\t\tif ( content && window.innerWidth > 768 ) {\n\t\t\t\tcontent.width = window.innerWidth - 275;\n\t\t\t}\n\t\t} );\n\t} )\n\n\t.config( function( $stateProvider, $urlRouterProvider, $httpProvider, $compileProvider, $ionicConfigProvider ) {\n\n\t\tif ( /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ) ) {\n\n\t\t\t// Change the default spinner for IE to android which has JS based animation\n\t\t\t$ionicConfigProvider.platform.default.spinner.icon( \"android\" );\n\t\t}\n\n\t\t// Change the back text to always say 'Back'\n\t\t$ionicConfigProvider.backButton.previousTitleText( false ).text( \"Back\" );\n\n\t\t// Use native scrolling for FireFox\n\t\tif ( /Firefox/.test( navigator.userAgent ) ) {\n\t\t\t$ionicConfigProvider.scrolling.jsScrolling( false );\n\t\t}\n\n\t\t// Modify Ionic's allowed href protocols to allow Firefox, Blackberry, iOS and Chrome support\n\t\t$compileProvider.aHrefSanitizationWhitelist( /^\\s*(https?|ftp|mailto|chrome-extension|app|local|file):/ );\n\n\t\t// Modify Ionic's allowed image source protocols\n\t\t$compileProvider.imgSrcSanitizationWhitelist( /^\\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\\// );\n\n\t\t// Define all available routes and their associated controllers\n\t\t$stateProvider\n\t\t\t.state( \"login\", {\n\t\t\t\turl: \"/login\",\n\t\t\t\ttemplateUrl: \"templates/login.html\",\n\t\t\t\tcontroller: \"LoginCtrl\"\n\t\t\t} )\n\n\t\t\t// Used as the parent route after authentication is complete allowing the same header\n\t\t\t// and side menu's to be used throughout all child views\n\t\t\t.state( \"app\", {\n\t\t\t\turl: \"/app\",\n\t\t\t\tabstract: true,\n\t\t\t\ttemplateUrl: \"templates/menu.html\",\n\t\t\t\tcontroller: \"MenuCtrl\"\n\t\t\t} )\n\n\t\t\t.state( \"app.home\", {\n\t\t\t\turl: \"/home\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/home.html\",\n\t\t\t\t\t\tcontroller: \"HomeCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $timeout, $q, $state, $rootScope, $filter, Utils ) {\n\t\t\t\t\t\tvar total = $rootScope.controllers.length,\n\t\t\t\t\t\t\tfilterFilter = $filter( \"filter\" ),\n\t\t\t\t\t\t\tinvalidOrg = ( $rootScope.activeController && filterFilter( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ).length === 0 ) ? true : false;\n\n\t\t\t\t\t\tif ( !$rootScope.activeController && total === 1 ) {\n\t\t\t\t\t\t\tUtils.setController( 0 );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$rootScope.activeController || invalidOrg ) {\n\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\n\t\t\t\t\t\t\t// If the active controller is not found in the controller list, show the select controller screen\n\t\t\t\t\t\t\t$timeout( function() {\n\t\t\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.rules\", {\n\t\t\t\turl: \"/rules\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/rules.html\",\n\t\t\t\t\t\tcontroller: \"RulesCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.controllerSelect\", {\n\t\t\t\turl: \"/controllerSelect\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/controllerSelect.html\",\n\t\t\t\t\t\tcontroller: \"ControllerSelectCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.history\", {\n\t\t\t\turl: \"/history\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/history.html\",\n\t\t\t\t\t\tcontroller: \"HistoryCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.settings\", {\n\t\t\t\turl: \"/settings\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/settings.html\",\n\t\t\t\t\t\tcontroller: \"SettingsCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.help\", {\n\t\t\t\turl: \"/help\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/help.html\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Defines the otherwise route which will redirect any invalid URL back to the start page\n\t\t\t.state( \"otherwise\", {\n\t\t\t\turl: \"*path\",\n\t\t\t\ttemplate: \"\",\n\t\t\t\tcontroller: function( $state, $rootScope ) {\n\n\t\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Add an HTTP interceptor\n\t\t$httpProvider.interceptors.push( function( $rootScope, $q, $injector ) {\n\t\t\treturn {\n\t\t\t\trequest: function( config ) {\n\n\t\t\t\t\t// When an AJAX request to the controller is started, fire an event to show a loading message\n\t\t\t\t\tif ( config.url.match( /^https?/ ) ) {\n\n\t\t\t\t\t\t// Change timeout to a promise we can cancel\n\t\t\t\t\t\tconfig.cancel = $q.defer();\n\n\t\t\t\t\t\t// Set the timeout to the canceller promise\n\t\t\t\t\t\tconfig.timeout = config.cancel.promise;\n\n\t\t\t\t\t\t// Set the current retry count to 0\n\t\t\t\t\t\tif ( typeof config.retryCount !== \"number\" ) {\n\t\t\t\t\t\t\tconfig.retryCount = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !config.suppressLoader ) {\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\", { canceller: config.cancel } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn config;\n\t\t\t\t},\n\t\t\t\tresponse: function( response ) {\n\n\t\t\t\t\t// If the request is to the controller, broadcast a hide loading message\n\t\t\t\t\tif ( !response.config.suppressLoader && response.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t\tresponseError: function( error ) {\n\n\t\t\t\t\t// If the timeout value is an object and is resolved, mark request as user canceled\n\t\t\t\t\tif ( error.config.timeout && error.config.timeout.$$state && error.config.timeout.$$state.status === 1 ) {\n\t\t\t\t\t\terror.canceled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !error.config.suppressLoader && error.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the request timed out and is not user canceled, retry the request up to three times\n\t\t\t\t\tif ( error.status <= 0 && !error.canceled ) {\n\t\t\t\t\t\tif ( error.config.retryCount < 3 ) {\n\t\t\t\t\t\t\tvar $http = $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\terror.config.retryCount++;\n\n\t\t\t\t\t\t\t// Return the new promise object\n\t\t\t\t\t\t\treturn $http( error.config );\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// After three timeouts, assume the network is down\n\t\t\t\t\t\t\terror.retryFailed = true;\n\t\t\t\t\t\t\terror.canceled = true;\n\n\t\t\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t}\n\t\t\t};\n\t\t} );\n\n\t\t// Inform Ionic we want to cache forward views\n\t\t$ionicConfigProvider.views.forwardCache( true );\n\t} )\n\n\t.filter( \"unique\", function() {\n\t\treturn function( items, filterOn ) {\n\t\t\tif ( filterOn === false ) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif ( ( filterOn || angular.isUndefined( filterOn ) ) && angular.isArray( items ) ) {\n\t\t\t\tvar newItems = [],\n\t\t\t\t\textractValueToCompare = function( item ) {\n\t\t\t\t\t\tif ( angular.isObject( item ) && angular.isString( filterOn ) ) {\n\t\t\t\t\t\t\treturn item[ filterOn ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tangular.forEach( items, function( item ) {\n\t\t\t\t\tvar isDuplicate = false;\n\n\t\t\t\t\tfor ( var i = 0; i < newItems.length; i++ ) {\n\t\t\t\t\t\tif ( angular.equals( extractValueToCompare( newItems[ i ] ), extractValueToCompare( item ) ) ) {\n\t\t\t\t\t\t\tisDuplicate = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( !isDuplicate ) {\n\t\t\t\t\t\tnewItems.push( item );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\titems = newItems;\n\t\t\t}\n\t\treturn items;\n\t\t};\n\t} )\n\n\t.directive( \"geoRuleSetup\", function( $rootScope, $filter ) {\n\t\treturn {\n\t\t\trestrict: \"E\",\n\t\t\treplace: true,\n\t\t\tscope: {\n\t\t\t\trule: \"=\"\n\t\t\t},\n\t\t\ttemplateUrl: \"templates/geoRuleSetup.html\",\n\t\t\tlink: function( scope, element ) {\n\t\t\t\tvar map, marker, circle;\n\n\t\t\t\tscope.updateRule = function() {\n\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\twindow.geofence.addOrUpdate( {\n\t\t\t\t\t\t\tid: scope.rule.direction + \"-\" + $rootScope.activeController.mac,\n\t\t\t\t\t\t\tlatitude: scope.rule.start.lat,\n\t\t\t\t\t\t\tlongitude: scope.rule.start.lng,\n\t\t\t\t\t\t\tradius: scope.rule.radius,\n\t\t\t\t\t\t\ttransitionType: scope.rule.direction === \"open\" ? 1 : 2,\n\t\t\t\t\t\t\tnotification: {\n\t\t\t\t\t\t\t\ttitle: \"OpenGarage Reminder\",\n\t\t\t\t\t\t\t\ttext: \"Tap here to \" + scope.rule.direction + \" the garage door...\",\n\t\t\t\t\t\t\t\topenAppOnClick: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tscope.updateMarker = function() {\n\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\tmarker.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tmarker = new google.maps.Marker( {\n\t\t\t\t\t\tposition: scope.rule.start,\n\t\t\t\t\t\tmap: map\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateRadius = function() {\n\t\t\t\t\tif ( circle ) {\n\t\t\t\t\t\tcircle.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tcircle = new google.maps.Circle( {\n\t\t\t\t\t\tstrokeColor: \"#FF0000\",\n\t\t\t\t\t\tstrokeOpacity: 0.8,\n\t\t\t\t\t\tstrokeWeight: 2,\n\t\t\t\t\t\tfillColor: \"#FF0000\",\n\t\t\t\t\t\tfillOpacity: 0.35,\n\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\tcenter: scope.rule.start,\n\t\t\t\t\t\tradius: parseInt( scope.rule.radius )\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateMap = function() {\n\t\t\t\t\tif ( !scope.rule.enable ) {\n\t\t\t\t\t\twindow.geofence.remove( scope.rule.direction + \"-\" + $rootScope.activeController.mac, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\tmap = new google.maps.Map( element[ 0 ].querySelectorAll( \".map\" )[ 0 ], {\n\t\t\t\t\t\t\tzoom: 16,\n\t\t\t\t\t\t\tstreetViewControl: false,\n\t\t\t\t\t\t\tmapTypeControl: false,\n\t\t\t\t\t\t\tcenter: scope.rule.start\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tgoogle.maps.event.addListener( map, \"click\", function( e ) {\n\t\t\t\t\t\t\tscope.rule.start = { lat: e.latLng.lat(), lng: e.latLng.lng() };\n\t\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t}, 100 );\n\t\t\t\t};\n\n\t\t\t\tscope.$watch( \"rule\", function() {\n\t\t\t\t\tvar currentRule = $filter( \"filter\" )( $rootScope.geoFences, { \"id\": scope.rule.direction + \"-\" + $rootScope.activeController.mac } )[ 0 ];\n\n\t\t\t\t\tif ( currentRule ) {\n\t\t\t\t\t\tscope.rule.radius = currentRule.radius;\n\t\t\t\t\t\tscope.rule.start = { lat: currentRule.latitude, lng: currentRule.longitude };\n\t\t\t\t\t\tscope.rule.enable = true;\n\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscope.rule.radius = scope.rule.radius || 500;\n\t\t\t\t\t\tscope.rule.start = scope.rule.start || { lat: 30.296519, lng: -97.730185 };\n\t\t\t\t\t\tscope.rule.enable = scope.rule.enable || false;\n\n\t\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\t\tnavigator.geolocation.getCurrentPosition( function( position ) {\n\t\t\t\t\t\t\t\tscope.rule.start = { lat: position.coords.latitude, lng: position.coords.longitude };\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, { timeout: 10000 } );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t} );\n\n/* global angular, sjcl */\n\n// OpenGarage\nangular.module( \"opengarage.cloud\", [ \"opengarage.utils\" ] )\n    .factory( \"Cloud\", [ \"$injector\", \"$rootScope\", \"Utils\", \"Settings\", function( $injector, $rootScope, Utils, Settings ) {\n\n        var requestAuth = function() {\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n                var scope = $rootScope.$new();\n                scope.data = {};\n\n                $ionicPopup.show( {\n                    templateUrl: \"templates/cloudLogin.html\",\n                    title: \"OpenGarage.io Login\",\n                    scope: scope,\n                    buttons: [\n                        { text: \"Cancel\" },\n                        {\n                            text: \"<b>Login</b>\",\n                            type: \"button-positive\",\n                            onTap: function( e ) {\n                                if ( !scope.data.username || !scope.data.password ) {\n                                    e.preventDefault();\n                                    return;\n                                }\n\n                                return true;\n                            }\n                        }\n                    ]\n                } ).then( function( isValid ) {\n                    if ( isValid ) {\n                        login( scope.data.username, scope.data.password, syncStart );\n                    }\n                } );\n            },\n            login = function( user, pass, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n                $http( {\n                    method: \"POST\",\n                    url: Settings.httpServer + \"/api/user/signin\",\n                    headers: {\n                        \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n                    },\n                    data: $httpParamSerializerJQLike( {\n                        email: encodeURIComponent( user ),\n                        password: encodeURIComponent( pass )\n                    } )\n                } ).then( function( result ) {\n                    if ( result.data.user !== undefined ) {\n                        Utils.storage.set( {\n                            \"cloudToken\": result.data.user.apikey,\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( pass ) )\n                        } );\n                        $rootScope.isSynced = true;\n                    }\n                    callback( result );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            logout = function() {\n                Utils.storage.remove( \"cloudToken\" );\n                $rootScope.isSynced = false;\n            },\n            syncStart = function() {\n\n                getControllers( function( controllers ) {\n                    if ( JSON.stringify( controllers ) === JSON.stringify( $rootScope.controllers ) ) {\n                        return;\n                    }\n\n                    if ( Object.keys( controllers ).length > 0 ) {\n                        $rootScope.controllers = controllers;\n                        Utils.storage.set( { \"controllers\": JSON.stringify( controllers ) }, function() { } );\n                        Utils.updateQuickLinks();\n                    }\n                } );\n            },\n            sync = function( callback ) {\n                callback = callback || function() {};\n                getControllers( function( data ) {\n                    if ( data !== false ) {\n                        Utils.storage.set( { \"controllers\": JSON.stringify( data ) }, callback );\n                        $rootScope.controllers = data;\n                        Utils.updateQuickLinks();\n                    }\n                } );\n            },\n            deleteController = function( device, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                var local = Utils.storage.get( [ \"cloudToken\" ] );\n                $http( {\n                    method: \"DELETE\",\n                    url: Settings.httpServer + \"/api/device/\" + device.deviceid,\n                    headers: {\n                        \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n                    },\n                    params: {\n                        \"apikey\": local.cloudToken\n                    }\n                } ).then( function( result ) {\n                    callback( result.data );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            getControllers = function( callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\" ], function( local ) {\n                    if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"GET\",\n                        url: Settings.httpServer + \"/api/device\",\n                        headers: {\n                            \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n                        },\n                        params: {\n                            \"apikey\": local.cloudToken\n                        }\n                    } ).then( function( result ) {\n                        if ( result.data.length !== undefined ) {\n                            for ( var i in result.data ) {\n                                if ( !result.data[ i ].hasOwnProperty( \"mac\" ) ) {\n                                    result.data[ i ].mac = result.data[ i ].deviceid;\n                                }\n                            }\n                        }\n                        callback( result.data );\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveController = function( callback ) {\n                if ( typeof callback !== \"function\" ) {\n                    callback = function() {};\n                }\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( local ) {\n                    if ( local.cloudToken === null || local.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n                    var data = {\n                        name: \"My door\",\n                        group: \"default\",\n                        deviceid: \"deviceid\",\n                        apikey: local.cloudToken,\n                        type: \"01\",\n                        ipAddr: \"192.\"\n                    };\n\n                    $http( {\n                        method: \"POST\",\n                        url: Settings.httpServer + \"/api/device\",\n                        headers: {\n                            \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n                        },\n                        data: $httpParamSerializerJQLike( data )\n                    } ).then( function( result ) {\n                        callback( result.data.success );\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveControllers = function( callback ) {\n                if ( typeof callback !== \"function\" ) {\n                    callback = function() {};\n                }\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n                    if ( data.cloudToken === null || data.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                        headers: {\n                            \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n                        },\n                        data: $httpParamSerializerJQLike( {\n                            token: data.cloudToken,\n                            controllerType: \"opengarage\",\n                            sites: encodeURIComponent( JSON.stringify( sjcl.encrypt( data.cloudDataToken, JSON.stringify( $rootScope.controllers ) ) ) )\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\": result.data.token } );\n                            callback( result.data.success );\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            handleInvalidDataToken = function() {\n                Utils.storage.remove( \"cloudDataToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.prompt( {\n                    title: \"Unable to read cloud data\",\n                    subTitle: \"Enter a valid password to decrypt the data\",\n                    template: \"Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.\",\n                    inputType: \"password\",\n                    inputPlaceholder: \"Password\"\n                } ).then( function( password ) {\n                    Utils.storage.set( {\n                        \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( password ) )\n                    } );\n                    sync();\n                } );\n            },\n            handleExpiredLogin = function() {\n                Utils.storage.remove( \"cloudToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.confirm( {\n                    title: \"OpenGarage.io Login Expired\",\n                    template: \"Click here to re-login to OpenGarage.io\"\n                } ).then( function( result ) {\n                    if ( result ) {\n\n                        requestAuth( function( result ) {\n                            if ( result === true ) {\n                                sync();\n                            }\n                        } );\n\n                    }\n                } );\n            },\n            getTokenUser = function( token ) {\n                return atob( token ).split( \"|\" )[ 0 ];\n            },\n            isLoggedIn = function( ) {\n                var local = Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ] );\n\n                // If cloud api key is missing\n                if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                    return false;\n                }\n\n                // If password not available\n                if ( local.cloudDataToken === undefined || local.cloudDataToken === null ) {\n                    return false;\n                }\n                return true;\n            },\n            $http, $httpParamSerializerJQLike, $ionicPopup;\n\n        Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n\n            if ( data.cloudToken === null || data.cloudToken === undefined || data.cloudDataToken === undefined || data.cloudDataToken === undefined ) {\n                $rootScope.isSynced = false;\n            } else {\n                $rootScope.isSynced = true;\n            }\n        } );\n\n        return {\n            requestAuth: requestAuth,\n            login: login,\n            logout: logout,\n            syncStart: syncStart,\n            sync: sync,\n            deleteController: deleteController,\n            getControllers: getControllers,\n            saveController: saveController,\n            saveControllers: saveControllers,\n            handleInvalidDataToken: handleInvalidDataToken,\n            handleExpiredLogin: handleExpiredLogin,\n            getTokenUser: getTokenUser,\n            isLoggedIn: isLoggedIn\n        };\n    } ] );\n\n/* global angular, ionic */\n\nangular.module( \"opengarage.controllers\", [ \"opengarage.utils\", \"opengarage.cloud\" ] )\n\n\t.controller( \"LoginCtrl\", function( $scope, $rootScope, $state, $ionicPopup, Cloud ) {\n\n\t\t// Auto-login if user information is present\n\t\tif ( Cloud.isLoggedIn( ) ) {\n\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\treturn;\n\t\t}\n\n\t\t$scope.data = {};\n\n\t\t$scope.submit = function() {\n\n\t\t\tif ( !$scope.data.username ) {\n\n\t\t\t\t// If no email is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a username to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else if ( !$scope.data.password ) {\n\n\t\t\t\t// If no password is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a password to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tCloud.login( $scope.data.username, $scope.data.password, function( result ) {\n\t\t\t\t\tif ( typeof result.data.error === \"string\" ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>\" + result.data.error + \"</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t$scope.skipCloud = function() {\n\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t};\n\t} )\n\n\t.controller( \"ControllerSelectCtrl\", function( $scope, $state, $rootScope, $timeout, $filter, $ionicModal, $ionicPopup, $ionicHistory, Utils, Cloud ) {\n\n\t\tif ( !Cloud.isLoggedIn( ) ) {\n\t\t\t$state.go( \"login\" );\n\t\t\treturn;\n\t\t}\n\n\t\t// Fetch devices from the cloud\n\t\tCloud.sync();\n\t\t$scope.data = {\n\t\t\tshowDelete: false\n\t\t};\n\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\n\t\t$scope.setController = function( index ) {\n\t\t\tUtils.setController( index );\n\n\t\t\t$ionicHistory.nextViewOptions( {\n\t\t\t\thistoryRoot: true\n\t\t\t} );\n\n\t\t\t$state.go( \"app.home\" );\n\t\t};\n\n\t\t$scope.deleteController = function( index ) {\n\t\t\tvar confirm = $ionicPopup.confirm( {\n\t\t\t\ttitle: \"Delete Controller\",\n\t\t\t\ttemplate: \"Are you sure?\"\n\t\t    } );\n\t\t\tconfirm.then( function( ans ) {\n\t\t\t\tif ( ans ) {\n\t\t\t\t\tvar device = $rootScope.controllers[ index ];\n\t\t\t\t\tCloud.deleteController( device, function( result ) {\n\t\t\t\t\t\tif ( typeof result.error === \"string\" ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p>\" + result.error + \"</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( Utils.getControllerIndex() === index ) {\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$rootScope.controllers.splice( index, 1 );\n\t\t\t\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t$scope.getTime = function( timestamp ) {\n\t\t\treturn new Date( timestamp ).toLocaleString();\n\t\t};\n\n\t\t$scope.changeSync = function() {\n\t\t\tCloud.syncStart();\n\t\t};\n\t} )\n\n\t.controller( \"HistoryCtrl\", function( $scope, $filter, $http, Utils ) {\n\t\tvar startTimeout = function() {\n\t\t\tif ( $http.pendingRequests.length < 3 ) {\n\t\t\t\tUtils.getLogs( function( reply ) {\n\t\t\t\t\t$scope.onLogs( reply );\n\t\t\t\t\ttimeout = setTimeout( function() {\n\t\t\t\t\t\tstartTimeout();\n\t\t\t\t\t}, 15000 );\n\t\t\t\t} );\n\t\t\t}\n\t\t}, timeout;\n\n\t\t$scope.onLogs = function( reply ) {\n\t\t\tif ( reply ) {\n\t\t\t\tvar i, current, day;\n\n\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\tfor ( i = 0; i < reply.length; i++ ) {\n\t\t\t\t\tcurrent = new Date( reply[ i ][ 0 ] * 1000 ).toDateString();\n\n\t\t\t\t\tif ( current !== day ) {\n\t\t\t\t\t\tday = current;\n\t\t\t\t\t\treply.splice( i, 0, { isDivider: \"true\", day: current } );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$scope.logs = reply;\n\t\t\t} else {\n\t\t\t\t$scope.isLocal = false;\n\t\t\t}\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tstartTimeout();\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearTimeout( timeout );\n\t\t} );\n\t} )\n\n\t.controller( \"SettingsCtrl\", function( $scope, $state, $ionicPopup, Utils ) {\n\t\t$scope.settings = {};\n\n\t\t$scope.changePassword = Utils.changePassword;\n\t\t$scope.restart = Utils.restartController;\n\n\t\t$scope.submit = function() {\n\t\t\tUtils.saveOptions( $scope.settings, function( reply ) {\n\t\t\t\tvar text;\n\n\t\t\t\tif ( reply ) {\n\t\t\t\t\ttext = \"Settings saved successfully!\";\n\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t} else {\n\t\t\t\t\ttext = \"Unable to save settings. Please check the connection to the device and try again.\";\n\t\t\t\t}\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>\" + text + \"</p>\"\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getControllerOptions( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\t$scope.isLocal = true;\n\n\t\t\t\t\t// Remove unused options to prevent accidental change\n\t\t\t\t\tdelete reply.mod;\n\t\t\t\t\tdelete reply.fwv;\n\t\t\t\t\t$scope.settings = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t}, null, true );\n\t\t} );\n\t} )\n\n\t.controller( \"MenuCtrl\", function( $scope, $rootScope, $state, $ionicActionSheet, $ionicPopup, $ionicSideMenuDelegate, $timeout, Utils, Cloud ) {\n\t\tif ( !Cloud.isLoggedIn( ) ) {\n\t\t\t$state.go( \"login\" );\n\t\t\treturn;\n\t\t}\n\n\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\t\t} );\n\n\t\t$scope.showAddController = function() {\n\t\t\t$ionicActionSheet.show( {\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ text: \"<i class='icon ion-ios-color-wand'></i> Setup New Device\" }\n\t\t\t\t],\n\t\t\t\ttitleText: \"Add Controller\",\n\t\t\t\tcancelText: \"Cancel\",\n\t\t\t\tbuttonClicked: function( index ) {\n\t\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\t\tUtils.checkNewController( function( result ) {\n\t\t\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Please first connect the power to your OpenGarage. Once complete, connect this device to the wifi network broadcast by the OpenGarage (named OG_XXXXXX) and reopen this app.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, false );\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t// Function to close the menu which is fired after a side menu link is clicked.\n\t\t// This is done instead of using the menu-close directive to preserve the root history stack\n\t    $scope.closeMenu = function() {\n            $ionicSideMenuDelegate.toggleLeft( false );\n\t    };\n\t} )\n\n\t.controller( \"HomeCtrl\", function( $rootScope, $scope, $ionicPopup, $filter, $http, $timeout, Utils ) {\n\t\tvar startTimeout = function() {\n\t\t\tif ( $http.pendingRequests.length < 3 ) {\n\t\t\t\tUtils.updateController( function() {\n\t\t\t\t\ttimeout = setTimeout( function() {\n\t\t\t\t\t\tstartTimeout();\n\t\t\t\t\t}, 15000 );\n\t\t\t\t} );\n\t\t\t}\n\t\t}, timeout;\n\n\t\t$scope.toggleDoor = function( ) {\n\t\t\tvar password = $rootScope.activeController.password;\n\t\t\tif ( password === undefined || password === \"\" ) {\n\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\ttitle: \"Empty Password Field\",\n\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to proceed?</p>\"\n\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t$rootScope.activeController.password = \"\";\n\t\t\t\t\t\tUtils.toggleDoor( function( ) {\n\t\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\t\tUtils.storage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tUtils.toggleDoor( function( ) {\n\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\tUtils.storage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\t\t$scope.currentIndex = Utils.getControllerIndex();\n\n\t\t$scope.changeController = function( direction ) {\n\t\t\tclearTimeout( timeout );\n\n\t\t\tvar current = Utils.getControllerIndex(),\n\t\t\t\tto = current + direction;\n\n\t\t\tif ( current === -1 || to < 0 || to >= $rootScope.controllers.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$scope.currentIndex = to;\n\t\t\tUtils.setController( to, startTimeout );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearTimeout( timeout );\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", startTimeout );\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.currentIndex = Utils.getControllerIndex();\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"RulesCtrl\", function( $scope, $rootScope ) {\n\t\tvar reset = function() {\n\t\t\t$scope.geo = {\n\t\t\t\thome: { direction: \"open\" },\n\t\t\t\taway: { direction: \"close\" }\n\t\t\t};\n\t\t\t$scope.set( \"home\" );\n\t\t};\n\n\t\t$scope.isAndroid = ionic.Platform.isAndroid();\n\n\t\t$scope.set = function( type ) {\n\t\t\tif ( type === \"home\" ) {\n\t\t\t\t$scope.current = $scope.geo.home;\n\t\t\t} else {\n\t\t\t\t$scope.current = $scope.geo.away;\n\t\t\t}\n\t\t};\n\n\t\t$rootScope.$on( \"controllerUpdated\", reset );\n\t\treset();\n\t} );\n\n/* global angular, window */\n\n// OpenGarage\nangular.module( \"opengarage.utils\", [] )\n    .factory( \"Utils\", [ \"$injector\", \"$rootScope\", \"Settings\", \"CloudProxy\", function( $injector, $rootScope, Settings, CloudProxy ) {\n\n\t\tvar isFireFox = /Firefox/.test( window.navigator.userAgent ),\n\t\t\tisIE = /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ),\n\n\t        // Define storage wrapper functions\n\t        storage = {\n\t            get: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var data = {},\n                        i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            data[ query[ i ] ] = localStorage.getItem( query[ i ] );\n                        }\n                    }\n\n                    callback( data );\n                    return data;\n\t            },\n\t            set: function( query, callback ) {\n\t                callback = callback || function() {};\n\t                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                    var i;\n                    if ( typeof query === \"object\" ) {\n                        for ( i in query ) {\n                            if ( query.hasOwnProperty( i ) ) {\n                                localStorage.setItem( i, query[ i ] );\n                            }\n                        }\n                    }\n\n                    callback( true );\n\t            },\n\t            remove: function( query, callback ) {\n\t                callback = callback || function() {};\n\t                var i;\n\t                if ( typeof query === \"string\" ) {\n\t\t\t\tquery = [ query ];\n\t                }\n\t                for ( i in query ) {\n\t\t\t\tif ( query.hasOwnProperty( i ) ) {\n\t\t\t\t\tlocalStorage.removeItem( query[ i ] );\n\t\t\t\t}\n\t\t\t}\n\t\t\tcallback( true );\n\t            }\n\t        },\n\t\t\tintToIP = function( int ) {\n\t\t\t\treturn ( int % 256 ) + \".\" + ( ( int / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) / 256 >> 0 );\n\t\t\t},\n\t        getControllerSettings = function( callback, ip, token ) {\n\t\t\t\tif ( !ip && !token && !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\t\t\t\tvar data = {\n\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\"apikey\": encodeURIComponent( token || $rootScope.activeController.apikey ),\n\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"jc\", \"args\": {} } ),\n\t\t\t\t\t\"ch\": \"jc\"\n\t\t\t\t};\n\t\t\t\tvar isCloud = token || ( !ip && ( $rootScope.activeController && $rootScope.activeController.apikey ) );\n\t\t\t\tpromise = CloudProxy.send( isCloud, data );\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( result.data.error !== undefined ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.data.lastUpdate = new Date().getTime();\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        getControllerOptions = function( callback, ip, showLoader ) {\n\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar promise;\n\t\t\t\tvar data = {\n\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"jo\", \"args\": {} } ),\n\t\t\t\t\t\"ch\": \"jo\"\n\t\t\t\t};\n\n\t\t\t\t// Cloud access\n\t\t\t\tvar isCloud = !ip && ( $rootScope.activeController && $rootScope.activeController.apikey );\n\t\t\t\tpromise = CloudProxy.send( isCloud, data, showLoader );\n\n\t            return promise.then(\n\t\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\t\tif ( result.data.error !== undefined ) {\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ( result.data.r !== undefined && result.data.r !== \"\" ) {\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t        },\n\t        updateController = function( callback ) {\n\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\tvar controller = angular.copy( $rootScope.activeController );\n\t\t\t\tvar\tsave = function( data ) {\n\t\t\t\t\t\t$rootScope.connected = true;\n\t\t\t\t\t\tangular.extend( controller, data );\n\t\t\t\t\t};\n\t\t\t\tvar promise;\n\t\t\t\tif ( controller.mnt === undefined ) {\n\t\t\t\t\tpromise = $q.when()\n\t\t\t\t\t.then( function() { return getControllerSettings( save ); } )\n\t\t\t\t\t.then( function() { return getControllerOptions( save ); } );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $q.when()\n\t\t\t\t\t.then( function() { return getControllerSettings( save ); } );\n\t\t\t\t}\n\t\t\t\tpromise.then( function() {\n\t\t\t\t\tvar index = getControllerIndex();\n\n\t\t\t\t\tif ( index >= 0 && controller.mac === $rootScope.activeController.mac ) {\n\t\t\t\t\t\t$rootScope.controllers[ index ] = controller;\n\t\t\t\t\t\t$rootScope.activeController = controller;\n\t\t\t\t\t\t$rootScope.$broadcast( \"controllerUpdated\" );\n\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\tcallback();\n\t\t\t\t} );\n\t        },\n\t        getControllerIndex = function( mac ) {\n\t\t\t\tif ( !$rootScope.activeController && !mac ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tmac = mac || ( $rootScope.activeController === null ? \"\" : $rootScope.activeController.mac );\n\n\t\t\t\tfor ( var i = 0; i < $rootScope.controllers.length; i++ ) {\n\t\t\t\t\tif ( $rootScope.controllers[ i ].mac === mac ) {\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t        },\n\t        setController = function( controller, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\n\t\t\t\tcancelPendingHttp();\n\t\t\t\t$rootScope.activeController = typeof controller === \"object\" ? controller : $rootScope.controllers[ controller ];\n\t\t\t\t$rootScope.connected = false;\n\t\t\t\tupdateController();\n\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) }, callback );\n\t\t\t\tupdateQuickLinks();\n\t        },\n\t\t\taddController = function( data, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( !data.token && ( !data.ip || !data.password ) ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Both an IP and password are required.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( data.token && data.token.length !== 32 ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>A valid Blynk token is required. Please verify your token and try again.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tgetControllerSettings( function( result ) {\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to find device. Please verify the IP/password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( result.mac ) {\n\t\t\t\t\t\tresult.ip = data.ip;\n\t\t\t\t\t\tresult.password = data.password;\n\n\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgetControllerOptions( function( reply ) {\n\t\t\t\t\t\t\tangular.extend( result, reply );\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t}, data.ip );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.token ) {\n\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\turl: \"https://openthings.io/wp-admin/admin-ajax.php\",\n\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\t\tdata: \"action=blynkCloud&path=\" + data.token + \"/get/V2\",\n\t\t\t\t\t\t\tsuppressLoader: true\n\t\t\t\t\t\t} ).then( function( reply ) {\n\t\t\t\t\t\t\tif ( reply.data === \"Invalid token.\" ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid Blynk token.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treply = reply.data.pop().split( \" \" )[ 1 ].split( \"_\" )[ 1 ];\n\t\t\t\t\t\t\tresult.mac = \"5C:CF:7F:\" + reply.match( /.{1,2}/g ).join( \":\" );\n\t\t\t\t\t\t\tresult.auth = data.token;\n\n\t\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$rootScope.controllers.push( result );\n\t\t\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdata.token ? null : data.ip,\n\t\t\t\tdata.token ? data.token : null\n\t\t\t\t);\n\t\t\t},\n\t\t\tcheckNewController = function( callback, suppressLoader ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: Settings.defaultIp + \"/js\",\n\t                suppressLoader: typeof suppressLoader !== \"undefined\" ? suppressLoader : true,\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tretryCount: 3\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( !result.data.ssids ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\t\t\tscope.data = {};\n\t\t\t\t\t\tscope.save = function() {\n\t\t\t\t\t\t\tscope.modal.hide();\n\t\t\t\t\t\t\tconnectNewController( scope.data );\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.ssids = result.data.ssids;\n\t\t\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/newControllerSetup.html\", {\n\t\t\t\t\t\t\tscope: scope,\n\t\t\t\t\t\t\tanimation: \"slide-in-up\"\n\t\t\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\t\t\tscope.modal = modal;\n\t\t\t\t\t\t\tmodal.show();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tconnectNewController = function( data ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\t\t\t\tstorage.get( \"cloudToken\", function( local ) {\n\t\t\t\t\tvar auth = \"&auth=\" + local.cloudToken;\n\t\t\t\t\t$http( {\n\t\t                method: \"GET\",\n\t\t                url: Settings.defaultIp + \"cc?ssid=\" + encodeURIComponent( data.ssid ) + \"&pass=\" + encodeURIComponent( data.password ) + auth\n\t\t            } ).then(\n\t\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\t\tif ( result.data.result === 1 ) {\n\t\t\t\t\t\t\t\tsetTimeout( saveNewController, 2000 );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid SSID/password combination. Please try again.</p>\"\n\t\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to reach controller. Please try again.</p>\"\n\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} );\n\t\t\t},\n\t\t\tsaveNewController = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/jt\"\n\t            } ).then( function( result ) {\n\t\t\t\t\tif ( result.data.ip === 0 ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Controller was unable to connect. Please check your SSID and password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Controller succesfully connected! Please wait while the device reboots.</p>\"\n\t\t\t\t\t} );\n\n\t\t\t\t\t$rootScope.controllers.push( {\n\t\t\t\t\t\tip: intToIP( result.data.ip ),\n\t\t\t\t\t\tpassword: \"opendoor\",\n\t\t\t\t\t\tname: \"My OpenGarage\"\n\t\t\t\t\t} );\n\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tscanLocalNetwork = function( callback ) {\n\t\t\t\tif ( !window.networkinterface ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.networkinterface.getIPAddress( function( router ) {\n\t\t\t\t\tif ( !router ) {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$q = $q || $injector.get( \"$q\" );\n\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t\trouter = router.split( \".\" );\n\t\t\t\t\trouter.pop();\n\n\t\t\t\t\tvar baseip = router.join( \".\" ),\n\t\t\t\t\t\tcheck = function( ip ) {\n\t\t\t\t\t\t\treturn $http( {\n\t\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\t\turl: \"http://\" + baseip + \".\" + ip + \"/jc\",\n\t\t\t\t\t\t\t\t\tsuppressLoader: true,\n\t\t\t\t\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\t\t\t\t\tretryCount: 3\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.then( function( result ) {\n\t\t\t\t\t\t\t\t\tif ( result.data && result.data.mac ) {\n\t\t\t\t\t\t\t\t\t\tmatches.push( baseip + \".\" + ip );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t.catch( function() {\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tqueue = [], matches = [], i;\n\n\t\t\t\t\t$rootScope.$broadcast( \"loading:show\" );\n\n\t\t\t\t    for ( i = 1; i <= 244; i++ ) {\n\t\t\t\t        queue.push( check( i ) );\n\t\t\t\t    }\n\n\t\t\t\t    $q.all( queue ).then( function() {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t\tcallback( matches );\n\t\t\t\t    } );\n\t\t\t\t} );\n\t\t\t},\n\t\t\trequestPassword = function( callback ) {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Enter Controller Password\",\n\t\t\t\t\ttemplate: \"Enter your controller's password below:\",\n\t\t\t\t\tinputType: \"password\",\n\t\t\t\t\tinputPlaceholder: \"Controller Password\"\n\t\t\t\t} ).then( function( password ) {\n\t\t\t\t\tcallback( password );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tupdateQuickLinks = function() {\n\t\t\t\tif ( !window.ThreeDeeTouch ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.ThreeDeeTouch.isAvailable( function( isAvailable ) {\n\t\t\t\t\tif ( !isAvailable || !$rootScope.controllers.length ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar links = [],\n\t\t\t\t\t\tlimit = $rootScope.controllers.length < 4 ? $rootScope.controllers.length : 4;\n\n\t\t\t\t\tfor ( var i = 0; i < limit; i++ ) {\n\t\t\t\t\t\tlinks.push( {\n\t\t\t\t\t\t\ttype: \"toggle-\" + $rootScope.controllers[ i ].mac,\n\t\t\t\t\t\t\ttitle: \"Toggle \" + $rootScope.controllers[ i ].name,\n\t\t\t\t\t\t\ticonType: \"Update\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.ThreeDeeTouch.configureQuickActions( links );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tcancelPendingHttp = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\t$http.pendingRequests.forEach( function( pendingReq ) {\n\t\t\t\t\tif ( pendingReq.cancel ) {\n\t\t\t\t\t\tpendingReq.cancel.resolve();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\t$http, $q, $filter, $ionicPopup, $ionicModal;\n\n\t    if ( isFireFox ) {\n\t\t\tHTMLElement.prototype.click = function() {\n\t\t\t\tvar evt = this.ownerDocument.createEvent( \"MouseEvents\" );\n\t\t\t\tevt.initMouseEvent( \"click\", true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t\t\tthis.dispatchEvent( evt );\n\t\t\t};\n\t    }\n\n        $rootScope.$on( \"controllersUpdated\", updateQuickLinks );\n\n\t    // Return usable functions\n\t    return {\n\t\t\tisIE: isIE,\n\t        storage: storage,\n\t        getControllerSettings: getControllerSettings,\n\t        getControllerOptions: getControllerOptions,\n\t        updateController: updateController,\n\t        setController: setController,\n\t        getControllerIndex: getControllerIndex,\n\t        checkNewController: checkNewController,\n\t        updateQuickLinks: updateQuickLinks,\n\t\t\tshowAddController: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {\n\t\t\t\t\tcanScan: window.networkinterface ? true : false\n\t\t\t\t};\n\t\t\t\tscope.scan = function() {\n\t\t\t\t\tscanLocalNetwork( function( result ) {\n\t\t\t\t\t\tif ( !result || !result.length ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>No devices detected on your network</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscope.data.foundControllers = result;\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t\tscope.save = function( ip ) {\n\t\t\t\t\tpopup.close();\n\t\t\t\t\trequestPassword( function( password ) {\n\t\t\t\t\t\taddController( {\n\t\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\t\tpassword: password\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addController.html\",\n\t\t\t\t\ttitle: \"Add Controller\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Add</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.ip || !scope.data.password ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddBlynk: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Add Controller by Blynk\",\n\t\t\t\t\ttemplate: \"Enter your Blynk Auth token below:\",\n\t\t\t\t\tinputType: \"text\",\n\t\t\t\t\tinputPlaceholder: \"Your Blynk Auth token\"\n\t\t\t\t} ).then( function( token ) {\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\taddController( { token: token }, callback );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\ttoggleDoor: function( auth, callback ) {\n\t\t\t\tif ( typeof auth === \"function\" ) {\n\t\t\t\t\tcallback = auth;\n\t\t\t\t\tauth = null;\n\t\t\t\t}\n\n\t\t\t\tcallback = callback || function() {};\n\n\t\t\t\tvar promise;\n\t\t\t\tvar data = {\n\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"cc\", \"args\": { \"p\": \"click\", \"dkey\": encodeURIComponent( $rootScope.activeController.password ) } } ),\n\t\t\t\t\t\"ch\": \"cc\"\n\t\t\t\t};\n\t\t\t\tif ( auth || ( $rootScope.activeController && $rootScope.activeController.apikey ) ) {\n\t\t\t\t\tpromise = CloudProxy.send( true, data );\n\t\t\t\t} else {\n\t\t\t\t\tdata.params = { \"dkey\": encodeURIComponent( $rootScope.activeController.password ), \"click\": 1 };\n\t\t\t\t\tpromise = CloudProxy.send( false, data );\n\t\t\t\t}\n\n\t            promise.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\trestartController: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\t\ttitle: \"Restart Controller?\",\n\t\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to restart the controller?</p>\"\n\t\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\tvar promise;\n\t\t\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"cc\", \"args\": { \"p\": \"reboot\", \"dkey\": encodeURIComponent( $rootScope.activeController.password ) } } ),\n\t\t\t\t\t\t\t\t\"ch\": \"cc\"\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tif ( $rootScope.activeController && $rootScope.activeController.apikey ) {\n\t\t\t\t\t\t\t\tpromise = CloudProxy.send( true, data );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata.params = { \"dkey\": encodeURIComponent( $rootScope.activeController.password ), \"reboot\": 1 };\n\t\t\t\t\t\t\t\tpromise = CloudProxy.send( false, data );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn promise.then( function( result ) {\n\t\t\t\t\t\t\t\tif ( result.data.result !== undefined && result.data.result !== 1 ) {\n\t\t\t\t\t\t\t\t\t$ionicPopup.alert( { title: \"Check device key and try again.\" + JSON.stringify( result ) } );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$ionicPopup.alert( { title: \"Reboot succesful!\" } );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsaveOptions: function( settings, callback ) {\n\t\t\t\tvar promise;\n\t\t\t\tvar data = {\n\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"co\", \"args\": settings } ),\n\t\t\t\t\t\"ch\": \"co\"\n\t\t\t\t};\n\t\t\t\tif ( $rootScope.activeController && $rootScope.activeController.apikey ) {\n\t\t\t\t\tpromise = CloudProxy.send( true, data );\n\t\t\t\t} else {\n\t\t\t\t\tdata.params = settings;\n\t\t\t\t\tdata.params.dkey = encodeURIComponent( $rootScope.activeController.password );\n\t\t\t\t\tpromise = CloudProxy.send( false, data );\n\t\t\t\t}\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( angular.equals( result.data, {} ) ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tchangePassword: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.pwd = {};\n\n\t\t\t\t$ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/changePassword.html\",\n\t\t\t\t\ttitle: \"Change Password\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Go</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} ).then( function() {\n\t\t\t\t\tif ( !scope.pwd.nkey || !scope.pwd.ckey || scope.pwd.nkey !== scope.pwd.ckey  ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tscope.pwd.dkey = encodeURIComponent( $rootScope.activeController.password );\n\n\t\t\t\t\tvar promise;\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"co\", \"args\": scope.pwd } ),\n\t\t\t\t\t\t\"ch\": \"co\"\n\t\t\t\t\t};\n\t\t\t\t\tif ( $rootScope.activeController && $rootScope.activeController.apikey ) {\n\t\t\t\t\t\tpromise = CloudProxy.send( true, data );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.params = scope.pwd;\n\t\t\t\t\t\tpromise = CloudProxy.send( false, data );\n\t\t\t\t\t}\n\n\t\t\t\t\tpromise.then( function( result ) {\n\t\t\t\t\t\tif ( result.data.error !== undefined ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>\" + result.data.error + \"</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.activeController.password = scope.pwd.nkey;\n\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Password updated succesfully!</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tgetLogs: function( callback ) {\n\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tvar promise;\n\t\t\t\tvar data = {\n\t\t\t\t\t\"referer\": \"client\",\n\t\t\t\t\t\"apikey\": $rootScope.activeController.apikey,\n\t\t\t\t\t\"deviceid\": $rootScope.activeController.deviceid,\n\t\t\t\t\t\"cmd\": JSON.stringify( { \"q\": \"jl\", \"args\": {} } ),\n\t\t\t\t\t\"ch\": \"jl\"\n\t\t\t\t};\n\t\t\t\tvar isCloud = $rootScope.activeController && $rootScope.activeController.apikey;\n\t\t\t\tpromise = CloudProxy.send( isCloud, data );\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( $rootScope.activeController && $rootScope.activeController.apikey ) {\n\t\t\t\t\t\t\tif ( result.data.error !== undefined ) {\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallback( result.data.logs.sort( function( a, b ) { return b[ 0 ] - a[ 0 ]; } ) );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tselectPhoto: function( $event, index, deletePhoto ) {\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t\t\t\tvar scope = $rootScope.$new(),\n\t\t\t\t\tfileInput = angular.element( document.getElementById( \"photoUpload\" ) );\n\n\t\t\t\tscope.data = {\n\t\t\t\t\timage: false,\n\t\t\t\t\tcropped: false,\n\t\t\t\t\tindex: false\n\t\t\t\t};\n\n\t\t\t\tscope.uploadPhoto = function( index ) {\n\t\t\t\t\tscope.crop.hide();\n\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\t$rootScope.activeController.image = scope.data.cropped;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\t$rootScope.controllers[ index ].image = scope.data.cropped;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t};\n\n\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/crop.html\", {\n\t\t\t\t\tscope: scope\n\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\tscope.crop = modal;\n\t\t\t\t} );\n\n\t\t\t\t$event.stopPropagation();\n\n\t\t\t\tif ( deletePhoto ) {\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\tdelete $rootScope.activeController.image;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete $rootScope.controllers[ index ].image;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfileInput.parent()[ 0 ].reset();\n\n\t\t\t\tfileInput.one( \"change\", function() {\n\t\t\t\t\tvar file = fileInput[ 0 ].files[ 0 ];\n\n\t\t\t\t\tif ( !file.type || !file.type.match( \"image.*\" ) ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.onload = function( evt ) {\n\t\t\t\t\t\tscope.data.image = evt.target.result;\n\t\t\t\t\t\tscope.data.index = index;\n\t\t\t\t\t\tscope.crop.show();\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL( file );\n\t\t\t\t} );\n\n\t\t\t\tfileInput[ 0 ].click();\n\t\t\t}\n\t    };\n} ] )\n\n.factory( \"CloudProxy\", [ \"$injector\", \"$rootScope\", \"Settings\", function( $injector, $rootScope, Settings ) {\n\n\tvar send = function( isCloud, data ) {\n\t\tvar promise;\n\t\t$http = $http || $injector.get( \"$http\" );\n\t\t$q = $q || $injector.get( \"$q\" );\n\t\tif ( isCloud ) {\n\t\t\tpromise = $http.post( Settings.httpServer + \"/api/proxy/client/send_request\", data )\n\t\t\t.then( function( result ) {\n\t\t\t\tvar deferred = $q.defer();\n\t\t\t\tif ( result.data.r !== undefined ) {\n\t\t\t\t\tif ( result.data.r === \"\" ) {\n\t\t\t\t\t\tresult.data = result.data.error !== undefined ? result.data.error : {};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.data = JSON.parse( result.data.r );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdeferred.resolve( result );\n\t\t\t\treturn deferred.promise;\n\t\t\t} );\n\t\t} else {\n\t\t\tpromise = $http( {\n\t\t\t\tmethod: \"GET\",\n\t\t\t\turl: \"http://\" + $rootScope.activeController.ipAddr + \"/\" + data.ch,\n\t\t\t\tparams: data.params,\n\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\",\n\t\t\t\tsuppressLoader: $rootScope.activeController.ipAddr ? false : true\n\t\t\t} );\n\t\t}\n\n\t\treturn promise;\n\t}, $http, $q;\n\n\treturn {\n\t\tsend: send\n\t};\n} ] )\n\n.factory( \"Settings\", [ function() {\n  var domain = \"cloud.opengarage.io\";\n\n  return {\n    httpServer: \"http://\" + domain,\n    websocketServer: \"ws://\" + domain,\n    defaultIp: \"http://192.168.4.1\",\n    http: \"http://\"\n  };\n} ] );\n\n/* global angular */\n\n// OpenGarage\nangular.module( \"opengarage.watch\", [] )\n    .factory( \"Watch\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar loadApp = function() {\n            if ( window.applewatch === undefined ) {\n                return;\n            }\n\n            window.applewatch.loadAppMain( {\n                title: \"OpenGarage\",\n                label: {\n                    value: \"Toggle Garage Door\",\n                    color: \"#FFA500\",\n                    font: {\n                        size: 12\n                    }\n                },\n                table: {\n                    callback: \"toggleDoorByIndex\",\n                    alpha: 1,\n                    rows: makeAppList()\n                }\n            } );\n        },\n        makeAppList = function() {\n            var rows = [];\n\n            $rootScope.controllers.forEach( function( controller ) {\n\t\t\t\tvar item = {\n                    type: \"OneColumnSelectableRowType\",\n                    group: {\n                        backgroundColor: \"#1884C4\",\n                        cornerRadius: 8\n                    },\n                    label: {\n                        value: \" \" + controller.name\n                    }\n                };\n\n                if ( controller.image ) {\n\n\t\t\t\t\tvar canvas = document.createElement( \"canvas\" ),\n\t\t\t\t\t\tctx = canvas.getContext( \"2d\" ),\n\t\t\t\t\t\timg = new Image();\n\n\t\t\t\t\timg.src = controller.image;\n\n\t\t\t\t\tcanvas.width = 25;\n\t\t\t\t\tcanvas.height = 30;\n\t\t\t\t\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\t\t\t\t\titem.imageLeft = {\n                        data: canvas.toDataURL( \"image/png\" ),\n                        width: canvas.width,\n                        height: canvas.height\n                    };\n                }\n\n                rows.push( item );\n            } );\n\n            return rows;\n        };\n\n        $rootScope.$on( \"controllersUpdated\", loadApp );\n\n        return {\n            loadApp: loadApp\n        };\n    } ] );\n"]}